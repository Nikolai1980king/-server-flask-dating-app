<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∫–µ—Ç—ã —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(76, 175, 80, 0.2);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.3);
        }
        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        .button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin: 10px 0;
        }
        .button:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
        }
        .button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .info {
            background: rgba(0, 123, 255, 0.2);
            border: 1px solid rgba(0, 123, 255, 0.5);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.5);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.5);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .log {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .hidden {
            display: none;
        }
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }
        .file-input-label {
            display: block;
            padding: 12px;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            color: white;
            text-align: center;
            cursor: pointer;
        }
        .file-input-label:hover {
            background: rgba(76, 175, 80, 0.3);
        }
    </style>
</head>
<body>
    <h1>üì± –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∫–µ—Ç—ã —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ</h1>
    
    <div class="test-section">
        <h2>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
        <div class="info">
            <strong>User Agent:</strong> <span id="user-agent"></span><br>
            <strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> <span id="device-type"></span><br>
            <strong>–†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞:</strong> <span id="screen-size"></span><br>
            <strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:</strong> <span id="geolocation-support"></span>
        </div>
    </div>

    <div class="test-section">
        <h2>üìù –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∫–µ—Ç—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)</h2>
        <form id="profile-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">–ò–º—è:</label>
                <input type="text" id="name" name="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            
            <div class="form-group">
                <label for="age">–í–æ–∑—Ä–∞—Å—Ç:</label>
                <input type="number" id="age" name="age" required min="18" max="100" placeholder="18">
            </div>
            
            <div class="form-group">
                <label for="gender">–ü–æ–ª:</label>
                <select id="gender" name="gender" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                    <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                    <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="hobbies">–•–æ–±–±–∏:</label>
                <textarea id="hobbies" name="hobbies" required placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–∏—Ö —É–≤–ª–µ—á–µ–Ω–∏—è—Ö"></textarea>
            </div>
            
            <div class="form-group">
                <label for="goal">–¶–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞:</label>
                <select id="goal" name="goal" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å</option>
                    <option value="friendship">–î—Ä—É–∂–±–∞</option>
                    <option value="relationship">–û—Ç–Ω–æ—à–µ–Ω–∏—è</option>
                    <option value="marriage">–ë—Ä–∞–∫</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="venue">–ó–∞–≤–µ–¥–µ–Ω–∏–µ:</label>
                <input type="text" id="venue" name="venue" required placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞">
            </div>
            
            <div class="form-group">
                <label for="photo">–§–æ—Ç–æ:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="photo" name="photo" accept="image/*" required>
                    <label for="photo" class="file-input-label">üì∑ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ</label>
                </div>
            </div>
            
            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç -->
            <input type="hidden" id="latitude" name="latitude" value="">
            <input type="hidden" id="longitude" name="longitude" value="">
            <input type="hidden" id="venue_lat" name="venue_lat" value="">
            <input type="hidden" id="venue_lng" name="venue_lng" value="">
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="terms-checkbox" name="terms_accepted" required>
                    –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="/terms" target="_blank">–ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</a>
                </label>
            </div>
            
            <button type="submit" id="create-btn" class="button" disabled>–°–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É</button>
        </form>
    </div>

    <div class="test-section">
        <h2>üìä –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <div id="log" class="log"></div>
        <button class="button" onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <div class="test-section">
        <h2>üîß –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏</h2>
        <button class="button" onclick="testGeolocation()">üìç –¢–µ—Å—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</button>
        <button class="button" onclick="testFormValidation()">‚úÖ –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã</button>
        <button class="button" onclick="testAJAX()">üì° –¢–µ—Å—Ç AJAX</button>
        <button class="button" onclick="fillTestData()">üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <script>
        let currentLocation = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function detectDevice() {
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isTablet = /iPad|Android(?=.*\bMobile\b)(?=.*\bSafari\b)/i.test(userAgent);
            
            document.getElementById('user-agent').textContent = userAgent;
            document.getElementById('device-type').textContent = isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ' : isTablet ? '–ü–ª–∞–Ω—à–µ—Ç' : '–î–µ—Å–∫—Ç–æ–ø';
            document.getElementById('screen-size').textContent = `${window.innerWidth}x${window.innerHeight}`;
            document.getElementById('geolocation-support').textContent = 'geolocation' in navigator ? '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            
            log(`–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: ${isMobile ? '–º–æ–±–∏–ª—å–Ω–æ–µ' : isTablet ? '–ø–ª–∞–Ω—à–µ—Ç' : '–¥–µ—Å–∫—Ç–æ–ø'}`);
        }

        function testGeolocation() {
            if (!navigator.geolocation) {
                log('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                return;
            }
            
            log('–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é...');
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    document.getElementById('latitude').value = currentLocation.lat;
                    document.getElementById('longitude').value = currentLocation.lng;
                    document.getElementById('venue_lat').value = currentLocation.lat + 0.001; // –°–º–µ—â–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ
                    document.getElementById('venue_lng').value = currentLocation.lng + 0.001;
                    
                    log(`–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞: ${currentLocation.lat}, ${currentLocation.lng}`, 'success');
                },
                function(error) {
                    log(`–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ${error.message}`, 'error');
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
                    document.getElementById('latitude').value = '55.7558';
                    document.getElementById('longitude').value = '37.6176';
                    document.getElementById('venue_lat').value = '55.7568';
                    document.getElementById('venue_lng').value = '37.6186';
                },
                { timeout: 10000, enableHighAccuracy: true }
            );
        }

        function testFormValidation() {
            const form = document.getElementById('profile-form');
            const isValid = form.checkValidity();
            log(`–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã: ${isValid ? '–ü–†–û–®–õ–ê' : '–ù–ï –ü–†–û–®–õ–ê'}`, isValid ? 'success' : 'error');
            
            if (!isValid) {
                const invalidElements = form.querySelectorAll(':invalid');
                invalidElements.forEach(element => {
                    log(`–ü–æ–ª–µ "${element.name}" –Ω–µ –ø—Ä–æ—à–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏—é`, 'error');
                });
            }
        }

        function testAJAX() {
            log('–¢–µ—Å—Ç–∏—Ä—É–µ–º AJAX –∑–∞–ø—Ä–æ—Å...');
            fetch('/api/profiles')
                .then(response => response.json())
                .then(data => {
                    log(`AJAX —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω: ${data.count} –∞–Ω–∫–µ—Ç –≤ –±–∞–∑–µ`, 'success');
                })
                .catch(error => {
                    log(`AJAX —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: ${error.message}`, 'error');
                });
        }

        function fillTestData() {
            document.getElementById('name').value = '–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            document.getElementById('age').value = '25';
            document.getElementById('gender').value = 'male';
            document.getElementById('hobbies').value = '–°–ø–æ—Ä—Ç, –º—É–∑—ã–∫–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è';
            document.getElementById('goal').value = 'friendship';
            document.getElementById('venue').value = '–¢–µ—Å—Ç–æ–≤–æ–µ –∫–∞—Ñ–µ';
            document.getElementById('terms-checkbox').checked = true;
            
            log('–ó–∞–ø–æ–ª–Ω–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ', 'success');
            updateCreateButton();
        }

        function updateCreateButton() {
            const checkbox = document.getElementById('terms-checkbox');
            const button = document.getElementById('create-btn');
            const form = document.getElementById('profile-form');
            
            const isFormValid = form.checkValidity();
            const isTermsAccepted = checkbox.checked;
            
            button.disabled = !(isFormValid && isTermsAccepted);
            
            if (button.disabled) {
                button.style.opacity = '0.5';
                button.style.cursor = 'not-allowed';
            } else {
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            log('–ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã...');
            
            const formData = new FormData(this);
            
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            for (let [key, value] of formData.entries()) {
                if (key !== 'photo') {
                    log(`–ü–æ–ª–µ ${key}: ${value}`);
                } else {
                    log(`–§–∞–π–ª: ${value.name} (${value.size} –±–∞–π—Ç)`);
                }
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
            fetch('/create', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                log(`–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: ${response.status} ${response.statusText}`);
                return response;
            })
            .then(response => {
                const contentType = response.headers.get('content-type');
                log(`Content-Type: ${contentType}`);
                
                if (contentType && contentType.includes('application/json')) {
                    return response.json();
                } else {
                    log('–ü–æ–ª—É—á–µ–Ω –Ω–µ-JSON –æ—Ç–≤–µ—Ç, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', 'error');
                    window.location.href = response.url;
                    return null;
                }
            })
            .then(data => {
                if (data) {
                    if (data.success) {
                        log(`–ê–Ω–∫–µ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ! ID: ${data.user_id}`, 'success');
                        alert('–ê–Ω–∫–µ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                        window.location.href = data.redirect;
                    } else {
                        log(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∫–µ—Ç—ã: ${data.error}`, 'error');
                        alert(`–û—à–∏–±–∫–∞: ${data.error}`);
                    }
                }
            })
            .catch(error => {
                log(`–û—à–∏–±–∫–∞ AJAX: ${error.message}`, 'error');
                alert(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('terms-checkbox').addEventListener('change', updateCreateButton);
        document.getElementById('profile-form').addEventListener('input', updateCreateButton);
        document.getElementById('photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                log(`–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${file.name} (${file.size} –±–∞–π—Ç)`);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            detectDevice();
            testGeolocation();
            updateCreateButton();
        };
    </script>
</body>
</html> 