<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .map-container {
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        #map {
            width: 100%;
            height: 400px;
            border-radius: 15px;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: #333;
        }
        
        .venue-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #333;
            font-size: 1em;
        }
        
        .btn {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            box-shadow: 0 4px 16px rgba(76,175,80,0.3);
            transform: translateY(-2px);
        }
        
        .debug-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
            color: #fff;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè™ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</h1>
        <p>1. –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"</p>
        <p>2. –ó–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±–æ–µ –∫–∞—Ñ–µ –∏–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –Ω–∞ –∫–∞—Ä—Ç–µ</p>
        <p>3. –í –ø–æ–ª–µ –Ω–∏–∂–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –Ω–µ—ë</p>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="info-panel" id="location-info" style="display: none;">
                <strong>üìç –í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong><br>
                <span id="location-address">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span><br>
                <small>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="location-coords">-</span></small>
            </div>
            <div style="text-align: center; margin: 10px 0;">
                <button type="button" class="btn" onclick="getCurrentLocation()">üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                <button type="button" class="btn" onclick="clearLocation()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button type="button" class="btn" onclick="createTestCafes()">üè™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ</button>
                <button type="button" class="btn" onclick="toggleDebug()">üêõ –û—Ç–ª–∞–¥–∫–∞</button>
            </div>
        </div>
        
        <label for="venue-input" style="display: block; margin-top: 15px; margin-bottom: 5px;">üè™ –í—ã–±—Ä–∞–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</label>
        <input type="text" name="venue" id="venue-input" class="venue-input" placeholder="–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –Ω–∞ –∫–∞—Ä—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞" readonly>
        
        <div style="text-align: center; margin: 15px 0;">
            <button type="button" class="btn" onclick="placeGreenMarker()" id="green-marker-btn" style="display: none; background: linear-gradient(90deg, #4CAF50 0%, #66BB6A 100%);">
                üü¢ –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É —Ä—è–¥–æ–º —Å –∫–∞—Ñ–µ
            </button>
            <button type="button" class="btn" onclick="readBalloonInfo()" style="background: linear-gradient(90deg, #2196F3 0%, #64B5F6 100%);">
                üìã –ß–∏—Ç–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–ª—É–Ω–∞
            </button>
        </div>
        
        <div class="debug-info" id="debug-info" style="display: none;">
            <strong>üêõ –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
            <div id="debug-content"></div>
        </div>
        
        <div class="info-panel">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ—è–≤–ª–µ–Ω–∏—è –∫—Ä–∞—Å–Ω–æ–π –º–µ—Ç–∫–∏ –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "üè™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω–∏—Ö –º–µ—Ç–æ–∫ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É</li>
                <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Å–∏–Ω—é—é –º–µ—Ç–∫—É –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±–∞–ª—É–Ω —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
                <li>–í –±–∞–ª—É–Ω–µ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ß–∏—Ç–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–ª—É–Ω–∞"</li>
                <li>–ü–æ–ª–µ "–í—ã–±—Ä–∞–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è" –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ–º, —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –∏ –∞–¥—Ä–µ—Å–æ–º</li>
                <li>–ü–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üü¢ –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É —Ä—è–¥–æ–º —Å –∫–∞—Ñ–µ" - –Ω–∞–∂–º–∏—Ç–µ –µ—ë –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏</li>
                <li>–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–∫—É –∫–Ω–æ–ø–∫–æ–π "üêõ –û—Ç–ª–∞–¥–∫–∞"</li>
            </ol>
        </div>
    </div>

    <script>
        let myMap, myPlacemark;
        let currentLocation = null;
        let debugMode = false;
        let selectedVenue = null;
        let greenMarker = null;

        function initMap() {
            ymaps.ready(function () {
                myMap = new ymaps.Map('map', {
                    center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    zoom: 10,
                    controls: ['zoomControl', 'fullscreenControl']
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
                myMap.events.add('click', function (e) {
                    var coords = e.get('coords');
                    var target = e.get('target');
                    
                    debugLog('–ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ:');
                    debugLog('- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ' + coords[0] + ', ' + coords[1]);
                    debugLog('- Target: ' + (target ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'));
                    
                    if (target && target.properties) {
                        debugLog('- Target properties: ' + JSON.stringify(target.properties.getAll()));
                        handleMapObjectClick(e);
                    } else {
                        debugLog('- –ö–ª–∏–∫ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ');
                        setLocation(coords[0], coords[1]);
                    }
                });

                debugLog('–ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            });
        }

        function setLocation(lat, lng) {
            currentLocation = {lat: lat, lng: lng};
            debugLog('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ' + lat + ', ' + lng);

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ venue –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
            document.getElementById('venue-input').value = '';

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–µ—Ç–∫—É
            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
            myPlacemark = new ymaps.Placemark([lat, lng], {
                balloonContent: '–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'
            }, {
                preset: 'islands#redDotIcon'
            });

            myMap.geoObjects.add(myPlacemark);
            myMap.setCenter([lat, lng], 15);

            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            ymaps.geocode([lat, lng]).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                var address = firstGeoObject.getAddressLine();

                document.getElementById('location-address').textContent = address;
                document.getElementById('location-coords').textContent = lat.toFixed(4) + ', ' + lng.toFixed(4);
                document.getElementById('location-info').style.display = 'block';
                debugLog('–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω: ' + address);
            });
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                debugLog('–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é...');
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        debugLog('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞: ' + lat + ', ' + lng);
                        setLocation(lat, lng);
                    },
                    function(error) {
                        debugLog('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ' + error.message);
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                    },
                    {
                        enableHighAccuracy: false,
                        timeout: 5000,
                        maximumAge: 300000
                    }
                );
            } else {
                debugLog('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.');
            }
        }

        function clearLocation() {
            currentLocation = null;
            selectedVenue = null;
            document.getElementById('venue-input').value = '';
            document.getElementById('location-info').style.display = 'none';
            document.getElementById('green-marker-btn').style.display = 'none';
            debugLog('–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—á–∏—â–µ–Ω–æ');

            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
                myPlacemark = null;
            }
            
            // –£–¥–∞–ª—è–µ–º –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ
            if (greenMarker) {
                myMap.geoObjects.remove(greenMarker);
                greenMarker = null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏
        function calculateDistance(lat1, lon1, lat2, lon2) {
            var R = 6371000; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã –∫–∞—Ä—Ç—ã (–∫–∞—Ñ–µ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)
        function handleMapObjectClick(e) {
            debugLog('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –æ–±—ä–µ–∫—Ç—É –∫–∞—Ä—Ç—ã');
            
            if (!currentLocation) {
                debugLog('–û–®–ò–ë–ö–ê: –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ');
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ!');
                return;
            }

            var coords = e.get('coords');
            var target = e.get('target');
            
            debugLog('- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞: ' + coords[0] + ', ' + coords[1]);
            debugLog('- Target: ' + (target ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'));
            
            if (!target || !target.properties) {
                debugLog('–û–®–ò–ë–ö–ê: –ù–µ—Ç —Å–≤–æ–π—Å—Ç–≤ —É –æ–±—ä–µ–∫—Ç–∞');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–µ
            var properties = target.properties;
            var name = properties.get('name') || properties.get('description') || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –º–µ—Å—Ç–æ';
            
            debugLog('- –ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞: ' + name);
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
            var distance = calculateDistance(
                currentLocation.lat, 
                currentLocation.lng, 
                coords[0], 
                coords[1]
            );
            
            debugLog('- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∫–∞—Ñ–µ
            selectedVenue = {
                name: name,
                lat: coords[0],
                lng: coords[1],
                distance: distance
            };
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
            var venueText = name + ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º)';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–≤–µ–¥–µ–Ω–∏—è
            document.getElementById('venue-input').value = venueText;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏
            document.getElementById('green-marker-btn').style.display = 'inline-block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–í—ã–±—Ä–∞–Ω–æ: ' + name + ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º). –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É!', 'success');
            
            debugLog('–£–°–ü–ï–•: –û–±—ä–µ–∫—Ç –≤—ã–±—Ä–∞–Ω –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ');
            debugLog('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞—Ñ–µ: ' + JSON.stringify(selectedVenue));
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ñ–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        function createTestCafes() {
            if (!currentLocation) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ!', 'error');
                return;
            }

            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ
            if (window.testCafes) {
                window.testCafes.forEach(function(cafe) {
                    myMap.geoObjects.remove(cafe);
                });
            }
            window.testCafes = [];

            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            var cafes = [
                {
                    name: '–ö–∞—Ñ–µ "–£—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ"',
                    phone: '+7 (495) 123-45-67',
                    address: '—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 15',
                    lat: currentLocation.lat + 0.001,
                    lng: currentLocation.lng + 0.001
                },
                {
                    name: '–†–µ—Å—Ç–æ—Ä–∞–Ω "–í–∫—É—Å–Ω–∞—è –µ–¥–∞"',
                    phone: '+7 (495) 234-56-78',
                    address: '—É–ª. –ê—Ä–±–∞—Ç, 25',
                    lat: currentLocation.lat - 0.001,
                    lng: currentLocation.lng + 0.002
                },
                {
                    name: '–ö–æ—Ñ–µ–π–Ω—è "–ê—Ä–æ–º–∞—Ç"',
                    phone: '+7 (495) 345-67-89',
                    address: '–ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä-—Ç, 10',
                    lat: currentLocation.lat + 0.002,
                    lng: currentLocation.lng - 0.001
                },
                {
                    name: '–ü–∏—Ü—Ü–µ—Ä–∏—è "–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è"',
                    phone: '+7 (495) 456-78-90',
                    address: '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∏–π –ø—Ä-—Ç, 35',
                    lat: currentLocation.lat - 0.002,
                    lng: currentLocation.lng - 0.002
                },
                {
                    name: '–ë–∞—Ä "–í–µ—á–µ—Ä–Ω–∏–π"',
                    phone: '+7 (495) 567-89-01',
                    address: '—É–ª. –ù–æ–≤—ã–π –ê—Ä–±–∞—Ç, 8',
                    lat: currentLocation.lat + 0.003,
                    lng: currentLocation.lng + 0.003
                }
            ];

            cafes.forEach(function(cafe) {
                // –°–æ–∑–¥–∞–µ–º HTML-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –±–∞–ª—É–Ω–∞
                var balloonContent = '<div style="padding: 10px; font-family: Arial, sans-serif;">' +
                    '<h3 style="margin: 0 0 10px 0; color: #333;">' + cafe.name + '</h3>' +
                    '<p style="margin: 5px 0; color: #666;">' +
                    '<strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> <a href="tel:' + cafe.phone + '" style="color: #2196F3;">' + cafe.phone + '</a>' +
                    '</p>' +
                    '<p style="margin: 5px 0; color: #666;">' +
                    '<strong>üìç –ê–¥—Ä–µ—Å:</strong> ' + cafe.address +
                    '</p>' +
                    '<button onclick="extractFromBalloon(\'' + cafe.name.replace(/'/g, '\\\'') + '\', \'' + cafe.phone + '\', \'' + cafe.address.replace(/'/g, '\\\'') + '\')" ' +
                    'style="background: #4CAF50; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-top: 10px;">' +
                    'üìã –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é' +
                    '</button>' +
                    '</div>';

                var cafePlacemark = new ymaps.Placemark([cafe.lat, cafe.lng], {
                    balloonContent: balloonContent
                }, {
                    preset: 'islands#blueDotIcon',
                    iconColor: '#2196F3'
                });

                cafePlacemark.properties.set('name', cafe.name);
                cafePlacemark.properties.set('phone', cafe.phone);
                cafePlacemark.properties.set('address', cafe.address);
                cafePlacemark.properties.set('type', 'cafe');

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ñ–µ
                cafePlacemark.events.add('click', function() {
                    handleMapObjectClick({
                        get: function(key) {
                            if (key === 'coords') return [cafe.lat, cafe.lng];
                            if (key === 'target') return cafePlacemark;
                        }
                    });
                });

                myMap.geoObjects.add(cafePlacemark);
                window.testCafes.push(cafePlacemark);
            });

            showNotification('–°–æ–∑–¥–∞–Ω–æ ' + cafes.length + ' —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ñ–µ! –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–∏–Ω–∏–µ –º–µ—Ç–∫–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.', 'success');
            debugLog('–°–æ–∑–¥–∞–Ω–æ ' + cafes.length + ' —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ñ–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π');
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–∞
        function extractFromBalloon(name, phone, address) {
            debugLog('–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–∞:');
            debugLog('- –ù–∞–∑–≤–∞–Ω–∏–µ: ' + name);
            debugLog('- –¢–µ–ª–µ—Ñ–æ–Ω: ' + phone);
            debugLog('- –ê–¥—Ä–µ—Å: ' + address);

            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Ä—Ç—ã
            var center = myMap.getCenter();
            debugLog('- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Ä—Ç—ã: ' + center[0] + ', ' + center[1]);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            selectedVenue = {
                name: name,
                phone: phone,
                address: address,
                lat: center[0], // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã –∫–∞–∫ –±–∞–∑–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                lng: center[1]
            };

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            document.getElementById('venue-input').value = name + ' | ' + phone + ' | ' + address;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏
            document.getElementById('green-marker-btn').style.display = 'inline-block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∞: ' + name, 'success');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–∞–ª—É–Ω
            if (myMap.balloon) {
                myMap.balloon.close();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –ª—é–±–æ–≥–æ –±–∞–ª—É–Ω–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
        function readBalloonInfo() {
            debugLog('–ü–æ–ø—ã—Ç–∫–∞ —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞–ª—É–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ç–∫—Ä—ã—Ç—ã–π –±–∞–ª—É–Ω
            if (!myMap.balloon || !myMap.balloon.isOpen()) {
                showNotification('–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –±–∞–ª—É–Ω–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è!', 'error');
                return;
            }

            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–ª—É–Ω–∞
                var balloonContent = myMap.balloon.getData().content;
                debugLog('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–ª—É–Ω–∞: ' + balloonContent);

                // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
                var nameMatch = balloonContent.match(/<h3[^>]*>([^<]+)<\/h3>/);
                var phoneMatch = balloonContent.match(/–¢–µ–ª–µ—Ñ–æ–Ω:<\/strong>\s*<a[^>]*>([^<]+)<\/a>/);
                var addressMatch = balloonContent.match(/–ê–¥—Ä–µ—Å:<\/strong>\s*([^<]+)/);

                var extractedInfo = {
                    name: nameMatch ? nameMatch[1].trim() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                    phone: phoneMatch ? phoneMatch[1].trim() : '–ù–µ —É–∫–∞–∑–∞–Ω',
                    address: addressMatch ? addressMatch[1].trim() : '–ù–µ —É–∫–∞–∑–∞–Ω'
                };

                debugLog('–ò–∑–≤–ª–µ—á–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: ' + JSON.stringify(extractedInfo));

                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Ä—Ç—ã
                var center = myMap.getCenter();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                selectedVenue = {
                    name: extractedInfo.name,
                    phone: extractedInfo.phone,
                    address: extractedInfo.address,
                    lat: center[0],
                    lng: center[1]
                };

                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ
                document.getElementById('venue-input').value = extractedInfo.name + ' | ' + extractedInfo.phone + ' | ' + extractedInfo.address;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                document.getElementById('green-marker-btn').style.display = 'inline-block';
                
                showNotification('üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏–∑ –±–∞–ª—É–Ω–∞: ' + extractedInfo.name, 'success');
                
            } catch (error) {
                debugLog('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –±–∞–ª—É–Ω–∞: ' + error.message);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–∞', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏ —Ä—è–¥–æ–º —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–∞—Ñ–µ
        function placeGreenMarker() {
            debugLog('–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ placeGreenMarker()');
            
            if (!selectedVenue) {
                debugLog('–û–®–ò–ë–ö–ê: selectedVenue –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ!', 'error');
                return;
            }

            debugLog('–í—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–∞—Ñ–µ: ' + JSON.stringify(selectedVenue));

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
            if (greenMarker) {
                debugLog('–£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É');
                myMap.geoObjects.remove(greenMarker);
            }

            // –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã
            var baseLat = selectedVenue.lat || myMap.getCenter()[0];
            var baseLng = selectedVenue.lng || myMap.getCenter()[1];

            // –†–∞–∑–º–µ—â–∞–µ–º –∑–µ–ª–µ–Ω—É—é –º–µ—Ç–∫—É —Ä—è–¥–æ–º —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–∞—Ñ–µ (—Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ 50 –º–µ—Ç—Ä–æ–≤)
            var offset = 0.0005; // –ø—Ä–∏–º–µ—Ä–Ω–æ 50 –º–µ—Ç—Ä–æ–≤
            var greenMarkerLat = baseLat + offset;
            var greenMarkerLng = baseLng + offset;

            debugLog('–ë–∞–∑–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ' + baseLat + ', ' + baseLng);
            debugLog('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏: ' + greenMarkerLat + ', ' + greenMarkerLng);

            try {
                greenMarker = new ymaps.Placemark([greenMarkerLat, greenMarkerLng], {
                    balloonContent: 'üü¢ –ó–µ–ª–µ–Ω–∞—è –º–µ—Ç–∫–∞ —Ä—è–¥–æ–º —Å ' + selectedVenue.name + 
                                  (selectedVenue.phone ? '<br>üìû ' + selectedVenue.phone : '') +
                                  (selectedVenue.address ? '<br>üìç ' + selectedVenue.address : '')
                }, {
                    preset: 'islands#greenDotIcon',
                    iconColor: '#4CAF50'
                });

                myMap.geoObjects.add(greenMarker);
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–µ
                myMap.setCenter([greenMarkerLat, greenMarkerLng], 16);
                
                showNotification('üü¢ –ó–µ–ª–µ–Ω–∞—è –º–µ—Ç–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞ —Ä—è–¥–æ–º —Å ' + selectedVenue.name, 'success');
                debugLog('–£–°–ü–ï–•: –ó–µ–ª–µ–Ω–∞—è –º–µ—Ç–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞: ' + greenMarkerLat + ', ' + greenMarkerLng);
            } catch (error) {
                debugLog('–û–®–ò–ë–ö–ê –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏: ' + error.message);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–µ–ª–µ–Ω–æ–π –º–µ—Ç–∫–∏: ' + error.message, 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            var existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(function(notification) {
                notification.remove();
            });

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            var notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                max-width: 400px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            if (type === 'success') {
                notification.style.background = 'linear-gradient(90deg, #4CAF50 0%, #81c784 100%)';
            } else if (type === 'error') {
                notification.style.background = 'linear-gradient(90deg, #f44336 0%, #e57373 100%)';
            } else {
                notification.style.background = 'linear-gradient(90deg, #2196F3 0%, #64B5F6 100%)';
            }

            document.body.appendChild(notification);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ª–∞–¥–∫–∏
        function debugLog(message) {
            if (debugMode) {
                var debugContent = document.getElementById('debug-content');
                var timestamp = new Date().toLocaleTimeString();
                debugContent.innerHTML += '<div>[' + timestamp + '] ' + message + '</div>';
                console.log('[DEBUG] ' + message);
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏
        function toggleDebug() {
            debugMode = !debugMode;
            var debugInfo = document.getElementById('debug-info');
            if (debugMode) {
                debugInfo.style.display = 'block';
                debugLog('–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω');
            } else {
                debugInfo.style.display = 'none';
                document.getElementById('debug-content').innerHTML = '';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html> 