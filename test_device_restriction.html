<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 1em;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .info { border-left: 4px solid #2196F3; }
    </style>
</head>
<body>
    <h1>üîí –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h1>
    
    <div class="test-section">
        <h2>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h2>
        <div id="device-info" class="result info"></div>
        <button class="btn" onclick="showDeviceInfo()">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</button>
    </div>

    <div class="test-section">
        <h2>üîç –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–ø–µ—á–∞—Ç–∫–∞</h2>
        <div id="fingerprint-result" class="result info"></div>
        <button class="btn" onclick="testFingerprint()">–°–æ–∑–¥–∞—Ç—å –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
    </div>

    <div class="test-section">
        <h2>üö´ –¢–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</h2>
        <div id="restriction-result" class="result info"></div>
        <button class="btn" onclick="testRestriction()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</button>
    </div>

    <div class="test-section">
        <h2>üåê –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∫–µ—Ç—ã</h2>
        <div id="create-result" class="result info"></div>
        <button class="btn" onclick="testCreateProfile()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É</button>
    </div>

    <div class="test-section">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h2>
        <div id="stats-result" class="result info"></div>
        <button class="btn" onclick="getDeviceStats()">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
    </div>

    <script>
        function showDeviceInfo() {
            const deviceInfo = {
                userAgent: navigator.userAgent,
                screenResolution: screen.width + 'x' + screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine
            };

            document.getElementById('device-info').textContent = JSON.stringify(deviceInfo, null, 2);
        }

        function testFingerprint() {
            const deviceInfo = {
                screen_resolution: screen.width + 'x' + screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                platform: navigator.platform,
                language: navigator.language
            };

            // –°–æ–∑–¥–∞–µ–º –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            const fingerprintData = `${navigator.userAgent}|${navigator.language}|gzip, deflate|${deviceInfo.screen_resolution}|${deviceInfo.timezone}|${deviceInfo.platform}|${deviceInfo.language}`;
            
            // –ü—Ä–æ—Å—Ç–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SHA256)
            let hash = 0;
            for (let i = 0; i < fingerprintData.length; i++) {
                const char = fingerprintData.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            
            const result = {
                fingerprintData: fingerprintData,
                hash: hash.toString(16),
                deviceInfo: deviceInfo
            };

            document.getElementById('fingerprint-result').textContent = JSON.stringify(result, null, 2);
        }

        function testRestriction() {
            fetch('/api/check-device-restriction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    screen_resolution: screen.width + 'x' + screen.height,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    platform: navigator.platform,
                    language: navigator.language
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('restriction-result').textContent = JSON.stringify(data, null, 2);
                document.getElementById('restriction-result').className = data.can_create ? 'result success' : 'result error';
            })
            .catch(error => {
                document.getElementById('restriction-result').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('restriction-result').className = 'result error';
            });
        }

        function testCreateProfile() {
            const formData = new FormData();
            formData.append('name', '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
            formData.append('age', '25');
            formData.append('gender', 'male');
            formData.append('hobbies', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã');
            formData.append('goal', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π');
            formData.append('screen_resolution', screen.width + 'x' + screen.height);
            formData.append('timezone', Intl.DateTimeFormat().resolvedOptions().timeZone);
            formData.append('platform', navigator.platform);
            formData.append('language', navigator.language);

            fetch('/create', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('create-result').textContent = JSON.stringify(data, null, 2);
                document.getElementById('create-result').className = data.success ? 'result success' : 'result error';
            })
            .catch(error => {
                document.getElementById('create-result').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('create-result').className = 'result error';
            });
        }

        function getDeviceStats() {
            fetch('/api/device-stats')
            .then(response => response.json())
            .then(data => {
                document.getElementById('stats-result').textContent = JSON.stringify(data, null, 2);
                document.getElementById('stats-result').className = 'result info';
            })
            .catch(error => {
                document.getElementById('stats-result').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('stats-result').className = 'result error';
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            showDeviceInfo();
        };
    </script>
</body>
</html>