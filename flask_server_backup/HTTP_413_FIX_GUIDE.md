# üîß –†–µ—à–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 413 "Request Entity Too Large"

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–û—à–∏–±–∫–∞ 413 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–∞–∑–º–µ—Ä, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤ nginx.

## ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è nginx
```bash
./restart_nginx_fix_413.sh
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Flask —Å–µ—Ä–≤–µ—Ä
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
python app_https_simple.py
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
–û—Ç–∫—Ä–æ–π—Ç–µ: `https://192.168.0.24:5000`

## üîç –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞**: `client_max_body_size 2048M;`
- **–õ–∏–º–∏—Ç —É–≤–µ–ª–∏—á–µ–Ω**: —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö 1MB –¥–æ 2GB
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ HTTPS**: –ø–æ—Ä—Ç 443

### 2. Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: `MAX_CONTENT_LENGTH = 2GB`
- **–í —Ñ–∞–π–ª–µ**: `app.py` (—Å—Ç—Ä–æ–∫–∞ 20)
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: —Å nginx –ª–∏–º–∏—Ç–æ–º

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`nginx_https.conf`** - –¥–æ–±–∞–≤–ª–µ–Ω `client_max_body_size 2048M;`
2. **`app.py`** - –¥–æ–±–∞–≤–ª–µ–Ω `MAX_CONTENT_LENGTH = 2GB`
3. **`restart_nginx_fix_413.sh`** - —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üõ†Ô∏è –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –î–ª—è nginx:
```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª
sudo nano /etc/nginx/sites-available/flask_server

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –≤ server –±–ª–æ–∫:
client_max_body_size 2048M;

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
sudo systemctl restart nginx
```

### –î–ª—è Flask:
```python
# –í app.py –¥–æ–±–∞–≤—å—Ç–µ:
app.config['MAX_CONTENT_LENGTH'] = 2 * 1024 * 1024 * 1024  # 2GB
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
sudo tail -f /var/log/nginx/error.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Flask:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
python test_upload.py

# –û—Ç–∫—Ä–æ–π—Ç–µ: http://192.168.255.137:5001/test_upload
```

## üìä –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ä—ã–π –ª–∏–º–∏—Ç | –ù–æ–≤—ã–π –ª–∏–º–∏—Ç |
|-----------|--------------|-------------|
| Nginx | 1MB | 2GB |
| Flask | –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | 2GB |
| –û–±—â–∏–π | 1MB | 2GB |

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ HTTP —Å–µ—Ä–≤–µ—Ä–∞
```bash
python test_upload.py
# –û—Ç–∫—Ä–æ–π—Ç–µ: http://192.168.255.137:5001
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTPS –±–µ–∑ nginx
```bash
python app_https_simple.py
# –û—Ç–∫—Ä–æ–π—Ç–µ: https://192.168.0.24:5000
```

### 3. –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ WebP
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

## üö® –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx**:
   ```bash
   sudo tail -f /var/log/nginx/error.log
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Flask**:
   ```bash
   # –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
   ```bash
   sudo chown -R www-data:www-data /home/nikolai/PycharmProjects/flask_server/static/uploads/
   sudo chmod 755 /home/nikolai/PycharmProjects/flask_server/static/uploads/
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ**:
   ```bash
   df -h
   ```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ª–æ–≥–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ nginx –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ 