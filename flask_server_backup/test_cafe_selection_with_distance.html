<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∫–∞—Ñ–µ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .map-container {
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        #map {
            width: 100%;
            height: 400px;
            border-radius: 15px;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: #333;
        }
        
        .venue-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #333;
            font-size: 1em;
        }
        
        .venue-input[readonly] {
            background: rgba(255, 255, 255, 0.7);
            color: #666;
            cursor: not-allowed;
        }
        
        .btn {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            box-shadow: 0 4px 16px rgba(76,175,80,0.3);
            transform: translateY(-2px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .success { background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%); }
        .error { background: linear-gradient(90deg, #f44336 0%, #e57373 100%); }
        .info { background: linear-gradient(90deg, #2196F3 0%, #64B5F6 100%); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè™ –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∫–∞—Ñ–µ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º</h1>
        <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ.</p>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="info-panel" id="location-info" style="display: none;">
                <strong>üìç –í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong><br>
                <span id="location-address">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span><br>
                <small>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="location-coords">-</span></small>
            </div>
            <div class="info-panel" id="cafe-info" style="display: none;">
                <strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–∞—Ñ–µ —Ä—è–¥–æ–º:</strong><br>
                <small>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ</small>
            </div>
            <div style="text-align: center; margin: 10px 0;">
                <button type="button" class="btn" onclick="getCurrentLocation()">üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                <button type="button" class="btn" onclick="clearLocation()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>
        
        <label for="venue-input" style="display: block; margin-top: 15px; margin-bottom: 5px;">üè™ –í—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–∞—Ñ–µ:</label>
        <input type="text" name="venue" id="venue-input" class="venue-input" placeholder="–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∑–∞–≤–µ–¥–µ–Ω–∏—è" readonly>
        
        <div class="info-panel">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ —Ä—è–¥–æ–º</li>
                <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–∏–Ω—é—é –º–µ—Ç–∫—É –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ</li>
                <li>–ü–æ–ª–µ "–í—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–∞—Ñ–µ" –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º</li>
            </ol>
        </div>
    </div>

    <script>
        let myMap, myPlacemark;
        let currentLocation = null;
        const MAX_DISTANCE = 100; // –º–µ—Ç—Ä–æ–≤

        function initMap() {
            ymaps.ready(function () {
                myMap = new ymaps.Map('map', {
                    center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    zoom: 10,
                    controls: ['zoomControl', 'fullscreenControl']
                });

                myMap.events.add('click', function (e) {
                    var coords = e.get('coords');
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ venue –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
                    document.getElementById('venue-input').value = '';
                    setLocation(coords[0], coords[1]);
                });
            });
        }

        function setLocation(lat, lng) {
            currentLocation = {lat: lat, lng: lng};

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ venue –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
            document.getElementById('venue-input').value = '';
            document.getElementById('cafe-info').style.display = 'none';

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–µ—Ç–∫—É
            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
            }

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ
            myMap.geoObjects.each(function(geoObject) {
                if (geoObject.properties.get('type') === 'cafe') {
                    myMap.geoObjects.remove(geoObject);
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
            myPlacemark = new ymaps.Placemark([lat, lng], {
                balloonContent: '–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'
            }, {
                preset: 'islands#blueDotIcon'
            });

            myMap.geoObjects.add(myPlacemark);
            myMap.setCenter([lat, lng], 15);

            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            ymaps.geocode([lat, lng]).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                var address = firstGeoObject.getAddressLine();

                document.getElementById('location-address').textContent = address;
                document.getElementById('location-coords').textContent = lat.toFixed(4) + ', ' + lng.toFixed(4);
                document.getElementById('location-info').style.display = 'block';
            });

            // –ò—â–µ–º –∫–∞—Ñ–µ —Ä—è–¥–æ–º —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            showNotification('üîç –ò—â–µ–º –∫–∞—Ñ–µ —Ä—è–¥–æ–º...', 'info');
            searchNearbyCafes(lat, lng);
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                showNotification('üìç –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...', 'info');
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ venue –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
                        document.getElementById('venue-input').value = '';
                        setLocation(lat, lng);
                        showNotification('‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!', 'success');
                    },
                    function(error) {
                        showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                    },
                    {
                        enableHighAccuracy: false,
                        timeout: 5000,
                        maximumAge: 300000
                    }
                );
            } else {
                showNotification('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.', 'error');
            }
        }

        function clearLocation() {
            currentLocation = null;
            document.getElementById('venue-input').value = '';
            document.getElementById('location-info').style.display = 'none';
            document.getElementById('cafe-info').style.display = 'none';

            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
                myPlacemark = null;
            }

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ
            myMap.geoObjects.each(function(geoObject) {
                if (geoObject.properties.get('type') === 'cafe') {
                    myMap.geoObjects.remove(geoObject);
                }
            });

            showNotification('üóëÔ∏è –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–∞—Ñ–µ –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        function searchNearbyCafes(lat, lng) {
            var searchRequest = '–∫–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∫–æ—Ñ–µ–π–Ω—è, –±–∞—Ä, –ø–∏—Ü—Ü–µ—Ä–∏—è, —Å—Ç–æ–ª–æ–≤–∞—è';
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            ymaps.geocode([lat, lng], {
                results: 20,
                kind: 'biz',
                text: searchRequest
            }).then(function (res) {
                var cafes = [];
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');

                    if (name && (name.toLowerCase().includes('–∫–∞—Ñ–µ') || 
                                name.toLowerCase().includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                                name.toLowerCase().includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                                name.toLowerCase().includes('–±–∞—Ä') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                                name.toLowerCase().includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                                name.toLowerCase().includes('–∑–∞–∫—É—Å–æ—á–Ω–∞—è') ||
                                name.toLowerCase().includes('–±–∏—Å—Ç—Ä–æ') ||
                                name.toLowerCase().includes('—á–∞–π–Ω–∞—è') ||
                                name.toLowerCase().includes('–∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è') ||
                                name.toLowerCase().includes('–ø–µ–∫–∞—Ä–Ω—è') ||
                                name.toLowerCase().includes('—à–∞—É—Ä–º–∞') ||
                                name.toLowerCase().includes('–±—É—Ä–≥–µ—Ä') ||
                                name.toLowerCase().includes('—Å—É—à–∏') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–∞'))) {
                        cafes.push({
                            name: name,
                            address: address,
                            coords: geoObject.geometry.getCoordinates()
                        });
                    }
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                cafes.forEach(function(cafe, index) {
                    var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                        balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address
                    }, {
                        preset: 'islands#blueDotIcon',
                        iconColor: '#ff6b6b'
                    });

                    cafePlacemark.properties.set('type', 'cafe');
                    cafePlacemark.properties.set('cafeName', cafe.name);

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ
                    cafePlacemark.events.add('click', function() {
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞—Ñ–µ
                        var distance = 0;
                        if (currentLocation) {
                            distance = calculateDistance(
                                currentLocation.lat, 
                                currentLocation.lng, 
                                cafe.coords[0], 
                                cafe.coords[1]
                            );
                        }
                        
                        // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
                        var venueText = cafe.name;
                        if (distance > 0) {
                            venueText += ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º)';
                        }
                        
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–≤–µ–¥–µ–Ω–∏—è
                        document.getElementById('venue-input').value = venueText;

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –∫–∞—Ñ–µ
                        showNotification('–í—ã–±—Ä–∞–Ω–æ –∫–∞—Ñ–µ: ' + cafe.name + ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º)', 'success');
                    });

                    myMap.geoObjects.add(cafePlacemark);
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ñ–µ
                if (cafes.length > 0) {
                    var cafeInfo = document.getElementById('cafe-info');
                    if (cafeInfo) {
                        cafeInfo.innerHTML = '<strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–∞—Ñ–µ —Ä—è–¥–æ–º:</strong><br>';
                        cafes.forEach(function(cafe) {
                            cafeInfo.innerHTML += '‚Ä¢ ' + cafe.name + '<br>';
                        });
                        cafeInfo.style.display = 'block';
                    }
                    showNotification('‚úÖ –ù–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∫–∞—Ñ–µ —Ä—è–¥–æ–º! –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞.', 'success');
                } else {
                    // –ï—Å–ª–∏ –∫–∞—Ñ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫
                    console.log('–ö–∞—Ñ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫...');
                    searchAlternativeCafes(lat, lng);
                }
            });
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            var R = 6371000; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // –§—É–Ω–∫—Ü–∏—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ
        function searchAlternativeCafes(lat, lng) {
            console.log('–ó–∞–ø—É—Å–∫–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –∫–∞—Ñ–µ...');
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ç–∏–ø—É
            ymaps.geocode([lat, lng], {
                results: 30,
                kind: 'biz'
            }).then(function (res) {
                var cafes = [];
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');

                    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π
                    if (name && (
                        name.toLowerCase().includes('–∫–∞—Ñ–µ') || 
                        name.toLowerCase().includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                        name.toLowerCase().includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                        name.toLowerCase().includes('–±–∞—Ä') ||
                        name.toLowerCase().includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                        name.toLowerCase().includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                        name.toLowerCase().includes('–∑–∞–∫—É—Å–æ—á–Ω–∞—è') ||
                        name.toLowerCase().includes('–±–∏—Å—Ç—Ä–æ') ||
                        name.toLowerCase().includes('—á–∞–π–Ω–∞—è') ||
                        name.toLowerCase().includes('–∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è') ||
                        name.toLowerCase().includes('–ø–µ–∫–∞—Ä–Ω—è') ||
                        name.toLowerCase().includes('—à–∞—É—Ä–º–∞') ||
                        name.toLowerCase().includes('–±—É—Ä–≥–µ—Ä') ||
                        name.toLowerCase().includes('—Å—É—à–∏') ||
                        name.toLowerCase().includes('–ø–∏—Ü—Ü–∞')
                    )) {
                        cafes.push({
                            name: name,
                            address: address,
                            coords: geoObject.geometry.getCoordinates()
                        });
                    }
                });

                if (cafes.length > 0) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                    cafes.forEach(function(cafe, index) {
                        var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                            balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address
                        }, {
                            preset: 'islands#blueDotIcon',
                            iconColor: '#ff6b6b'
                        });

                        cafePlacemark.properties.set('type', 'cafe');
                        cafePlacemark.properties.set('cafeName', cafe.name);

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ
                        cafePlacemark.events.add('click', function() {
                            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞—Ñ–µ
                            var distance = 0;
                            if (currentLocation) {
                                distance = calculateDistance(
                                    currentLocation.lat, 
                                    currentLocation.lng, 
                                    cafe.coords[0], 
                                    cafe.coords[1]
                                );
                            }
                            
                            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
                            var venueText = cafe.name;
                            if (distance > 0) {
                                venueText += ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º)';
                            }
                            
                            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–≤–µ–¥–µ–Ω–∏—è
                            document.getElementById('venue-input').value = venueText;

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –∫–∞—Ñ–µ
                            showNotification('–í—ã–±—Ä–∞–Ω–æ –∫–∞—Ñ–µ: ' + cafe.name + ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(distance) + '–º)', 'success');
                        });

                        myMap.geoObjects.add(cafePlacemark);
                    });

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ñ–µ
                    var cafeInfo = document.getElementById('cafe-info');
                    if (cafeInfo) {
                        cafeInfo.innerHTML = '<strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è —Ä—è–¥–æ–º (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫):</strong><br>';
                        cafes.forEach(function(cafe) {
                            cafeInfo.innerHTML += '‚Ä¢ ' + cafe.name + '<br>';
                        });
                        cafeInfo.style.display = 'block';
                    }
                    showNotification('‚úÖ –ù–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∑–∞–≤–µ–¥–µ–Ω–∏–π! –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞.', 'success');
                } else {
                    // –ï—Å–ª–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø—Ä–æ–±—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
                    console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø—Ä–æ–±—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫...');
                    searchTextCafes(lat, lng);
                }
            }).catch(function(error) {
                console.error('–û—à–∏–±–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:', error);
                showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ
        function searchTextCafes(lat, lng) {
            console.log('–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –∫–∞—Ñ–µ...');
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞
            ymaps.geocode([lat, lng]).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                var address = firstGeoObject.getAddressLine();
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ª–∏—Ü—ã –∏–ª–∏ —Ä–∞–π–æ–Ω–∞
                var searchText = '';
                var components = address.split(', ');
                
                // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
                for (var i = 0; i < components.length; i++) {
                    var component = components[i].trim();
                    if (component && component.length > 3 && 
                        !component.toLowerCase().includes('—Ä–æ—Å—Å–∏—è') &&
                        !component.toLowerCase().includes('–æ–±–ª–∞—Å—Ç—å') &&
                        !component.toLowerCase().includes('–∫—Ä–∞–π') &&
                        !component.toLowerCase().includes('—Ä–µ—Å–ø—É–±–ª–∏–∫–∞')) {
                        searchText = component;
                        break;
                    }
                }
                
                if (searchText) {
                    // –ò—â–µ–º –∫–∞—Ñ–µ –ø–æ —Ç–µ–∫—Å—Ç—É
                    ymaps.geocode(searchText + ' –∫–∞—Ñ–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω', {
                        results: 20,
                        kind: 'biz'
                    }).then(function (res) {
                        var cafes = [];
                        res.geoObjects.each(function (geoObject) {
                            var properties = geoObject.properties;
                            var name = properties.get('name');
                            var cafeAddress = properties.get('description');
                            var cafeCoords = geoObject.geometry.getCoordinates();
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–∞—Ñ–µ
                            var distance = calculateDistance(lat, lng, cafeCoords[0], cafeCoords[1]);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–∞—Ñ–µ –≤ —Ä–∞–∑—É–º–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ (–¥–æ 5 –∫–º)
                            if (distance <= 5000 && name && (
                                name.toLowerCase().includes('–∫–∞—Ñ–µ') || 
                                name.toLowerCase().includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                                name.toLowerCase().includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                                name.toLowerCase().includes('–±–∞—Ä') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                                name.toLowerCase().includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                                name.toLowerCase().includes('–∑–∞–∫—É—Å–æ—á–Ω–∞—è') ||
                                name.toLowerCase().includes('–±–∏—Å—Ç—Ä–æ') ||
                                name.toLowerCase().includes('—á–∞–π–Ω–∞—è') ||
                                name.toLowerCase().includes('–∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è') ||
                                name.toLowerCase().includes('–ø–µ–∫–∞—Ä–Ω—è') ||
                                name.toLowerCase().includes('—à–∞—É—Ä–º–∞') ||
                                name.toLowerCase().includes('–±—É—Ä–≥–µ—Ä') ||
                                name.toLowerCase().includes('—Å—É—à–∏') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–∞')
                            )) {
                                cafes.push({
                                    name: name,
                                    address: cafeAddress,
                                    coords: cafeCoords,
                                    distance: distance
                                });
                            }
                        });
                        
                        if (cafes.length > 0) {
                            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
                            cafes.sort(function(a, b) {
                                return a.distance - b.distance;
                            });
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                            cafes.forEach(function(cafe, index) {
                                var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                                    balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address + '<br>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(cafe.distance) + '–º'
                                }, {
                                    preset: 'islands#blueDotIcon',
                                    iconColor: '#ff6b6b'
                                });

                                cafePlacemark.properties.set('type', 'cafe');
                                cafePlacemark.properties.set('cafeName', cafe.name);

                                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ
                                cafePlacemark.events.add('click', function() {
                                    // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
                                    var venueText = cafe.name + ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(cafe.distance) + '–º)';
                                    
                                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–≤–µ–¥–µ–Ω–∏—è
                                    document.getElementById('venue-input').value = venueText;

                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –∫–∞—Ñ–µ
                                    showNotification('–í—ã–±—Ä–∞–Ω–æ –∫–∞—Ñ–µ: ' + cafe.name + ' (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(cafe.distance) + '–º)', 'success');
                                });

                                myMap.geoObjects.add(cafePlacemark);
                            });

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ñ–µ
                            var cafeInfo = document.getElementById('cafe-info');
                            if (cafeInfo) {
                                cafeInfo.innerHTML = '<strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –≤ —Ä–∞–π–æ–Ω–µ:</strong><br>';
                                cafes.forEach(function(cafe) {
                                    cafeInfo.innerHTML += '‚Ä¢ ' + cafe.name + ' (' + Math.round(cafe.distance) + '–º)<br>';
                                });
                                cafeInfo.style.display = 'block';
                            }
                            showNotification('‚úÖ –ù–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∑–∞–≤–µ–¥–µ–Ω–∏–π –≤ —Ä–∞–π–æ–Ω–µ! –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞.', 'success');
                        } else {
                            showNotification('‚ö†Ô∏è –ó–∞–≤–µ–¥–µ–Ω–∏–π –≤ —Ä–∞–π–æ–Ω–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.', 'error');
                        }
                    }).catch(function(error) {
                        console.error('–û—à–∏–±–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞:', error);
                        showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                    });
                } else {
                    showNotification('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–π–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.', 'error');
                }
            });
        }

        function showNotification(message, type) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            var existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(function(notification) {
                notification.remove();
            });

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            var notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.textContent = message;

            document.body.appendChild(notification);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html> 