<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .map-container {
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        #map {
            width: 100%;
            height: 400px;
            border-radius: 15px;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: #333;
        }
        
        .btn {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            box-shadow: 0 4px 16px rgba(76,175,80,0.3);
            transform: translateY(-2px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .success { background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%); }
        .error { background: linear-gradient(90deg, #f44336 0%, #e57373 100%); }
        .info { background: linear-gradient(90deg, #2196F3 0%, #64B5F6 100%); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè™ –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º –ø–æ–∏—Å–∫–æ–º!</p>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="info-panel" id="location-info" style="display: none;">
                <strong>üìç –í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong><br>
                <span id="location-address">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span><br>
                <small>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="location-coords">-</span></small>
            </div>
            <div class="info-panel" id="cafe-info" style="display: none;">
                <strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è:</strong><br>
                <small>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ</small>
            </div>
            <div class="info-panel" id="selected-object-info" style="display: none;">
                <strong>üéØ –í—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç:</strong><br>
                <div style="margin: 10px 0;">
                    <label for="venue-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è:</label><br>
                    <input type="text" id="venue-name" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; margin: 5px 0;" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç">
                </div>
                <div style="margin: 10px 0;">
                    <label for="venue-coords">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</label><br>
                    <input type="text" id="venue-coords" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; margin: 5px 0;" placeholder="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç" readonly>
                </div>
                <small style="color: #666;">üí° –ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –ª—é–±–æ–π –æ–±—ä–µ–∫—Ç –Ω–∞ –∫–∞—Ä—Ç–µ –∏–ª–∏ –∫–æ—Å–Ω–∏—Ç–µ—Å—å –ø–∞–ª—å—Ü–µ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</small>
            </div>
            <div style="text-align: center; margin: 10px 0;">
                <button type="button" class="btn" onclick="getCurrentLocation()">üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                <button type="button" class="btn" onclick="clearLocation()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button type="button" class="btn" onclick="testSearch()">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>üìã –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:</h3>
            <ol>
                <li><strong>–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫</strong> - –∫–∞—Ñ–µ –≤ —Ä–∞–¥–∏—É—Å–µ 100–º</li>
                <li><strong>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫</strong> - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (30 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)</li>
                <li><strong>–¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫</strong> - –ø–æ–∏—Å–∫ –ø–æ —Ä–∞–π–æ–Ω—É (–¥–æ 5–∫–º)</li>
                <li><strong>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π</strong> - –∫–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –±–∞—Ä—ã, –ø–∏—Ü—Ü–µ—Ä–∏–∏, —Å—Ç–æ–ª–æ–≤—ã–µ, –∑–∞–∫—É—Å–æ—á–Ω—ã–µ, –±–∏—Å—Ç—Ä–æ, —á–∞–π–Ω—ã–µ, –∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏–µ, –ø–µ–∫–∞—Ä–Ω–∏, —à–∞—É—Ä–º–∞, –±—É—Ä–≥–µ—Ä—ã, —Å—É—à–∏</li>
            </ol>
        </div>
    </div>

    <script>
        let myMap, myPlacemark;
        let currentLocation = null;

        function initMap() {
            ymaps.ready(function () {
                myMap = new ymaps.Map('map', {
                    center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    zoom: 10,
                    controls: ['zoomControl', 'fullscreenControl']
                });

                myMap.events.add('click', function (e) {
                    var coords = e.get('coords');
                    setLocation(coords[0], coords[1]);
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                myMap.events.add('mousemove', function (e) {
                    handleMapHover(e);
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–∞—Å–∞–Ω–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                myMap.events.add('actionend', function (e) {
                    if (e.get('type') === 'drag') {
                        // –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ä–µ–∫—Ç—ã –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                        setTimeout(function() {
                            var center = myMap.getCenter();
                            checkObjectsAtPoint(center[0], center[1]);
                        }, 100);
                    }
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                document.getElementById('selected-object-info').style.display = 'block';
            });
        }

        function setLocation(lat, lng) {
            currentLocation = {lat: lat, lng: lng};

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–µ—Ç–∫—É
            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
            }

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ
            myMap.geoObjects.each(function(geoObject) {
                if (geoObject.properties.get('type') === 'cafe') {
                    myMap.geoObjects.remove(geoObject);
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
            myPlacemark = new ymaps.Placemark([lat, lng], {
                balloonContent: '–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'
            }, {
                preset: 'islands#blueDotIcon'
            });

            myMap.geoObjects.add(myPlacemark);
            myMap.setCenter([lat, lng], 15);

            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            ymaps.geocode([lat, lng]).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                var address = firstGeoObject.getAddressLine();

                document.getElementById('location-address').textContent = address;
                document.getElementById('location-coords').textContent = lat.toFixed(4) + ', ' + lng.toFixed(4);
                document.getElementById('location-info').style.display = 'block';
            });

            // –ò—â–µ–º –∫–∞—Ñ–µ —Ä—è–¥–æ–º —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            showNotification('üîç –ò—â–µ–º –∫–∞—Ñ–µ —Ä—è–¥–æ–º...', 'info');
            searchNearbyCafes(lat, lng);
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                showNotification('üìç –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...', 'info');
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        setLocation(lat, lng);
                        showNotification('‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!', 'success');
                    },
                    function(error) {
                        showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                    },
                    {
                        enableHighAccuracy: false,
                        timeout: 5000,
                        maximumAge: 300000
                    }
                );
            } else {
                showNotification('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.', 'error');
            }
        }

        function clearLocation() {
            currentLocation = null;
            document.getElementById('location-info').style.display = 'none';
            document.getElementById('cafe-info').style.display = 'none';

            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            var nameInput = document.getElementById('venue-name');
            var coordsInput = document.getElementById('venue-coords');
            if (nameInput) nameInput.value = '';
            if (coordsInput) coordsInput.value = '';

            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
                myPlacemark = null;
            }

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ
            myMap.geoObjects.each(function(geoObject) {
                if (geoObject.properties.get('type') === 'cafe') {
                    myMap.geoObjects.remove(geoObject);
                }
            });

            showNotification('üóëÔ∏è –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—á–∏—â–µ–Ω–æ', 'info');
        }

        function testSearch() {
            if (!currentLocation) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ!', 'error');
                return;
            }
            
            showNotification('üîç –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ...', 'info');
            searchNearbyCafes(currentLocation.lat, currentLocation.lng);
        }

        function searchNearbyCafes(lat, lng) {
            var searchRequest = '–∫–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∫–æ—Ñ–µ–π–Ω—è, –±–∞—Ä, –ø–∏—Ü—Ü–µ—Ä–∏—è, —Å—Ç–æ–ª–æ–≤–∞—è';
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            ymaps.geocode([lat, lng], {
                results: 20,
                kind: 'biz',
                text: searchRequest
            }).then(function (res) {
                var cafes = [];
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');

                    if (name && (name.toLowerCase().includes('–∫–∞—Ñ–µ') || 
                                name.toLowerCase().includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                                name.toLowerCase().includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                                name.toLowerCase().includes('–±–∞—Ä') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                                name.toLowerCase().includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                                name.toLowerCase().includes('–∑–∞–∫—É—Å–æ—á–Ω–∞—è') ||
                                name.toLowerCase().includes('–±–∏—Å—Ç—Ä–æ') ||
                                name.toLowerCase().includes('—á–∞–π–Ω–∞—è') ||
                                name.toLowerCase().includes('–∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è') ||
                                name.toLowerCase().includes('–ø–µ–∫–∞—Ä–Ω—è') ||
                                name.toLowerCase().includes('—à–∞—É—Ä–º–∞') ||
                                name.toLowerCase().includes('–±—É—Ä–≥–µ—Ä') ||
                                name.toLowerCase().includes('—Å—É—à–∏') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–∞'))) {
                        cafes.push({
                            name: name,
                            address: address,
                            coords: geoObject.geometry.getCoordinates()
                        });
                    }
                });

                if (cafes.length > 0) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                    cafes.forEach(function(cafe, index) {
                        var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                            balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address
                        }, {
                            preset: 'islands#blueDotIcon',
                            iconColor: '#ff6b6b'
                        });

                        cafePlacemark.properties.set('type', 'cafe');
                        cafePlacemark.properties.set('cafeName', cafe.name);

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ
                        cafePlacemark.events.add('click', function() {
                            updateVenueInfo(cafe.name, cafe.address, cafe.coords[0], cafe.coords[1]);
                            showNotification('‚úÖ –í—ã–±—Ä–∞–Ω–æ –∑–∞–≤–µ–¥–µ–Ω–∏–µ: ' + cafe.name, 'success');
                        });

                        myMap.geoObjects.add(cafePlacemark);
                    });

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ñ–µ
                    var cafeInfo = document.getElementById('cafe-info');
                    if (cafeInfo) {
                        cafeInfo.innerHTML = '<strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è (–æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫):</strong><br>';
                        cafes.forEach(function(cafe) {
                            cafeInfo.innerHTML += '‚Ä¢ ' + cafe.name + '<br>';
                        });
                        cafeInfo.style.display = 'block';
                    }
                    showNotification('‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫: –Ω–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∑–∞–≤–µ–¥–µ–Ω–∏–π!', 'success');
                } else {
                    // –ï—Å–ª–∏ –∫–∞—Ñ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫
                    console.log('–ö–∞—Ñ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫...');
                    searchAlternativeCafes(lat, lng);
                }
            });
        }

        function searchAlternativeCafes(lat, lng) {
            console.log('–ó–∞–ø—É—Å–∫–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –∫–∞—Ñ–µ...');
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ç–∏–ø—É
            ymaps.geocode([lat, lng], {
                results: 30,
                kind: 'biz'
            }).then(function (res) {
                var cafes = [];
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');

                    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π
                    if (name && (
                        name.toLowerCase().includes('–∫–∞—Ñ–µ') || 
                        name.toLowerCase().includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                        name.toLowerCase().includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                        name.toLowerCase().includes('–±–∞—Ä') ||
                        name.toLowerCase().includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                        name.toLowerCase().includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                        name.toLowerCase().includes('–∑–∞–∫—É—Å–æ—á–Ω–∞—è') ||
                        name.toLowerCase().includes('–±–∏—Å—Ç—Ä–æ') ||
                        name.toLowerCase().includes('—á–∞–π–Ω–∞—è') ||
                        name.toLowerCase().includes('–∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è') ||
                        name.toLowerCase().includes('–ø–µ–∫–∞—Ä–Ω—è') ||
                        name.toLowerCase().includes('—à–∞—É—Ä–º–∞') ||
                        name.toLowerCase().includes('–±—É—Ä–≥–µ—Ä') ||
                        name.toLowerCase().includes('—Å—É—à–∏') ||
                        name.toLowerCase().includes('–ø–∏—Ü—Ü–∞')
                    )) {
                        cafes.push({
                            name: name,
                            address: address,
                            coords: geoObject.geometry.getCoordinates()
                        });
                    }
                });

                if (cafes.length > 0) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                    cafes.forEach(function(cafe, index) {
                        var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                            balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address
                        }, {
                            preset: 'islands#blueDotIcon',
                            iconColor: '#ff6b6b'
                        });

                        cafePlacemark.properties.set('type', 'cafe');
                        cafePlacemark.properties.set('cafeName', cafe.name);

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ
                        cafePlacemark.events.add('click', function() {
                            updateVenueInfo(cafe.name, cafe.address, cafe.coords[0], cafe.coords[1]);
                            showNotification('‚úÖ –í—ã–±—Ä–∞–Ω–æ –∑–∞–≤–µ–¥–µ–Ω–∏–µ: ' + cafe.name, 'success');
                        });

                        myMap.geoObjects.add(cafePlacemark);
                    });

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ñ–µ
                    var cafeInfo = document.getElementById('cafe-info');
                    if (cafeInfo) {
                        cafeInfo.innerHTML = '<strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫):</strong><br>';
                        cafes.forEach(function(cafe) {
                            cafeInfo.innerHTML += '‚Ä¢ ' + cafe.name + '<br>';
                        });
                        cafeInfo.style.display = 'block';
                    }
                    showNotification('‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫: –Ω–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∑–∞–≤–µ–¥–µ–Ω–∏–π!', 'success');
                } else {
                    // –ï—Å–ª–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø—Ä–æ–±—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
                    console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø—Ä–æ–±—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫...');
                    searchTextCafes(lat, lng);
                }
            }).catch(function(error) {
                console.error('–û—à–∏–±–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:', error);
                showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
            });
        }

        function searchTextCafes(lat, lng) {
            console.log('–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –∫–∞—Ñ–µ...');
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞
            ymaps.geocode([lat, lng]).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                var address = firstGeoObject.getAddressLine();
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ª–∏—Ü—ã –∏–ª–∏ —Ä–∞–π–æ–Ω–∞
                var searchText = '';
                var components = address.split(', ');
                
                // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
                for (var i = 0; i < components.length; i++) {
                    var component = components[i].trim();
                    if (component && component.length > 3 && 
                        !component.toLowerCase().includes('—Ä–æ—Å—Å–∏—è') &&
                        !component.toLowerCase().includes('–æ–±–ª–∞—Å—Ç—å') &&
                        !component.toLowerCase().includes('–∫—Ä–∞–π') &&
                        !component.toLowerCase().includes('—Ä–µ—Å–ø—É–±–ª–∏–∫–∞')) {
                        searchText = component;
                        break;
                    }
                }
                
                if (searchText) {
                    // –ò—â–µ–º –∫–∞—Ñ–µ –ø–æ —Ç–µ–∫—Å—Ç—É
                    ymaps.geocode(searchText + ' –∫–∞—Ñ–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω', {
                        results: 20,
                        kind: 'biz'
                    }).then(function (res) {
                        var cafes = [];
                        res.geoObjects.each(function (geoObject) {
                            var properties = geoObject.properties;
                            var name = properties.get('name');
                            var cafeAddress = properties.get('description');
                            var cafeCoords = geoObject.geometry.getCoordinates();
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–∞—Ñ–µ
                            var distance = calculateDistance(lat, lng, cafeCoords[0], cafeCoords[1]);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–∞—Ñ–µ –≤ —Ä–∞–∑—É–º–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ (–¥–æ 5 –∫–º)
                            if (distance <= 5000 && name && (
                                name.toLowerCase().includes('–∫–∞—Ñ–µ') || 
                                name.toLowerCase().includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                                name.toLowerCase().includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                                name.toLowerCase().includes('–±–∞—Ä') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                                name.toLowerCase().includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                                name.toLowerCase().includes('–∑–∞–∫—É—Å–æ—á–Ω–∞—è') ||
                                name.toLowerCase().includes('–±–∏—Å—Ç—Ä–æ') ||
                                name.toLowerCase().includes('—á–∞–π–Ω–∞—è') ||
                                name.toLowerCase().includes('–∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è') ||
                                name.toLowerCase().includes('–ø–µ–∫–∞—Ä–Ω—è') ||
                                name.toLowerCase().includes('—à–∞—É—Ä–º–∞') ||
                                name.toLowerCase().includes('–±—É—Ä–≥–µ—Ä') ||
                                name.toLowerCase().includes('—Å—É—à–∏') ||
                                name.toLowerCase().includes('–ø–∏—Ü—Ü–∞')
                            )) {
                                cafes.push({
                                    name: name,
                                    address: cafeAddress,
                                    coords: cafeCoords,
                                    distance: distance
                                });
                            }
                        });
                        
                        if (cafes.length > 0) {
                            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
                            cafes.sort(function(a, b) {
                                return a.distance - b.distance;
                            });
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                            cafes.forEach(function(cafe, index) {
                                var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                                    balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address + '<br>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(cafe.distance) + '–º'
                                }, {
                                    preset: 'islands#blueDotIcon',
                                    iconColor: '#ff6b6b'
                                });

                                cafePlacemark.properties.set('type', 'cafe');
                                cafePlacemark.properties.set('cafeName', cafe.name);

                                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–µ—Ç–∫—É –∫–∞—Ñ–µ
                                cafePlacemark.events.add('click', function() {
                                    updateVenueInfo(cafe.name, cafe.address, cafe.coords[0], cafe.coords[1]);
                                    showNotification('‚úÖ –í—ã–±—Ä–∞–Ω–æ –∑–∞–≤–µ–¥–µ–Ω–∏–µ: ' + cafe.name, 'success');
                                });

                                myMap.geoObjects.add(cafePlacemark);
                            });

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ñ–µ
                            var cafeInfo = document.getElementById('cafe-info');
                            if (cafeInfo) {
                                cafeInfo.innerHTML = '<strong>üè™ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫):</strong><br>';
                                cafes.forEach(function(cafe) {
                                    cafeInfo.innerHTML += '‚Ä¢ ' + cafe.name + ' (' + Math.round(cafe.distance) + '–º)<br>';
                                });
                                cafeInfo.style.display = 'block';
                            }
                            showNotification('‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫: –Ω–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∑–∞–≤–µ–¥–µ–Ω–∏–π –≤ —Ä–∞–π–æ–Ω–µ!', 'success');
                        } else {
                            showNotification('‚ö†Ô∏è –ó–∞–≤–µ–¥–µ–Ω–∏–π –≤ —Ä–∞–π–æ–Ω–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.', 'error');
                        }
                    }).catch(function(error) {
                        console.error('–û—à–∏–±–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞:', error);
                        showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                    });
                } else {
                    showNotification('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–π–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.', 'error');
                }
            });
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            var R = 6371000; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function handleMapHover(e) {
            var coords = e.get('coords');
            if (coords) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ä–µ–∫—Ç—ã –≤ —Ç–æ—á–∫–µ –Ω–∞–≤–µ–¥–µ–Ω–∏—è
                checkObjectsAtPoint(coords[0], coords[1]);
            }
        }

        function checkObjectsAtPoint(lat, lng) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö –≤ —Ç–æ—á–∫–µ
            ymaps.geocode([lat, lng], {
                results: 5,
                kind: 'biz'
            }).then(function (res) {
                var venueName = '';
                var venueAddress = '';
                
                // –ò—â–µ–º –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ–±—ä–µ–∫—Ç
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');
                    
                    if (name && name.trim() !== '') {
                        venueName = name;
                        venueAddress = address || '';
                        return false; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                    }
                });

                // –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å
                if (!venueName) {
                    ymaps.geocode([lat, lng]).then(function (res) {
                        var firstGeoObject = res.geoObjects.get(0);
                        if (firstGeoObject) {
                            venueName = firstGeoObject.getAddressLine();
                            venueAddress = '';
                        }
                        updateVenueInfo(venueName, venueAddress, lat, lng);
                    });
                } else {
                    updateVenueInfo(venueName, venueAddress, lat, lng);
                }
            }).catch(function(error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–∫—Ç–µ:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                updateVenueInfo('', '', lat, lng);
            });
        }

        function updateVenueInfo(name, address, lat, lng) {
            var nameInput = document.getElementById('venue-name');
            var coordsInput = document.getElementById('venue-coords');
            
            if (nameInput && coordsInput) {
                if (name && name.trim() !== '') {
                    nameInput.value = name;
                    if (address && address.trim() !== '') {
                        nameInput.title = address; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ
                    }
                } else {
                    nameInput.value = '–ê–¥—Ä–µ—Å: ' + (address || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
                }
                
                coordsInput.value = lat.toFixed(6) + ', ' + lng.toFixed(6);
            }
        }

        function showNotification(message, type) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            var existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(function(notification) {
                notification.remove();
            });

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            var notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.textContent = message;

            document.body.appendChild(notification);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html> 