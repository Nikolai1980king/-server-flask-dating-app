<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        input[type="file"]:hover {
            border-color: #007bff;
        }
        .preview {
            margin-top: 20px;
            text-align: center;
        }
        .preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        .error {
            background: #ffe7e7;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        .success {
            background: #e7ffe7;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .console {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h1>
        
        <div class="info">
            <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong>
            <ul>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ 50MB</li>
                <li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PNG, JPG, JPEG, GIF, WebP</li>
                <li>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∞—Ç–∞ –¥–æ 800x800px</li>
                <li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–∏–∂–µ</li>
            </ul>
        </div>

        <form id="upload-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="photo">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é:</label>
                <input type="file" id="photo" name="photo" accept="image/*" onchange="previewPhoto(this)">
            </div>

            <div class="form-group">
                <label for="name">–ò–º—è (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="name" name="name" value="–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" required>
            </div>

            <div class="form-group">
                <label for="age">–í–æ–∑—Ä–∞—Å—Ç (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="number" id="age" name="age" value="25" required>
            </div>

            <div class="form-group">
                <label for="gender">–ü–æ–ª (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <select id="gender" name="gender" required>
                    <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                    <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
            </div>

            <div class="form-group">
                <label for="hobbies">–•–æ–±–±–∏ (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="hobbies" name="hobbies" value="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" required>
            </div>

            <div class="form-group">
                <label for="goal">–¶–µ–ª—å (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="goal" name="goal" value="–¢–µ—Å—Ç" required>
            </div>

            <div class="form-group">
                <label for="venue">–ú–µ—Å—Ç–æ (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="venue" name="venue" value="–¢–µ—Å—Ç–æ–≤–æ–µ –∫–∞—Ñ–µ" required>
            </div>

            <div class="form-group">
                <label for="latitude">–®–∏—Ä–æ—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="latitude" name="latitude" value="55.7558" required>
            </div>

            <div class="form-group">
                <label for="longitude">–î–æ–ª–≥–æ—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="longitude" name="longitude" value="37.6176" required>
            </div>

            <div class="form-group">
                <label for="venue_lat">–®–∏—Ä–æ—Ç–∞ –º–µ—Å—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="venue_lat" name="venue_lat" value="55.7558" required>
            </div>

            <div class="form-group">
                <label for="venue_lng">–î–æ–ª–≥–æ—Ç–∞ –º–µ—Å—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞):</label>
                <input type="text" id="venue_lng" name="venue_lng" value="37.6176" required>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="terms_accepted" name="terms_accepted" required>
                    –°–æ–≥–ª–∞—Å–µ–Ω —Å —É—Å–ª–æ–≤–∏—è–º–∏ (–¥–ª—è —Ç–µ—Å—Ç–∞)
                </label>
            </div>

            <div id="preview" class="preview" style="display: none;">
                <h3>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</h3>
                <img id="preview-img" src="" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä">
                <div id="file-info"></div>
            </div>

            <button type="submit" id="submit-btn">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
        </form>

        <div id="console" class="console">
            <strong>–ö–æ–Ω—Å–æ–ª—å –æ—Ç–ª–∞–¥–∫–∏:</strong><br>
            <div id="console-output"></div>
        </div>
    </div>

    <script>
        function log(message) {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `[${timestamp}] ${message}<br>`;
            console.scrollTop = console.scrollHeight;
        }

        function previewPhoto(input) {
            try {
                log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä...');
                
                const file = input.files[0];
                if (!file) {
                    log('‚ùå –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω');
                    return;
                }

                log(`üì∏ –§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${file.name}`);
                log(`üìè –†–∞–∑–º–µ—Ä: ${(file.size / 1024 / 1024).toFixed(2)} MB`);
                log(`üé® –¢–∏–ø: ${file.type}`);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä
                if (file.size > 50 * 1024 * 1024) {
                    log('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 50MB');
                    showError('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 50MB');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø
                const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                if (!allowedTypes.includes(file.type)) {
                    log('‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞');
                    showError('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: JPG, PNG, GIF, WebP');
                    return;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                const fileInfo = document.getElementById('file-info');
                fileInfo.innerHTML = `
                    <p><strong>–ò–º—è:</strong> ${file.name}</p>
                    <p><strong>–†–∞–∑–º–µ—Ä:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                    <p><strong>–¢–∏–ø:</strong> ${file.type}</p>
                    <p><strong>–ë—É–¥–µ—Ç —Å–∂–∞—Ç–æ –¥–æ:</strong> 800x800px, 85% JPEG</p>
                `;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('preview').style.display = 'block';
                    log('‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥—Ä—É–∂–µ–Ω');
                };
                reader.onerror = function(e) {
                    log('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + e);
                    showError('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
                };
                reader.readAsDataURL(file);

            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –≤ previewPhoto: ' + error.message);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.getElementById('console'));
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.getElementById('console'));
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        document.getElementById('upload-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                log('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã...');
                
                const formData = new FormData(this);
                const submitBtn = document.getElementById('submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...';

                // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                log('üìÅ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:');
                for (let [key, value] of formData.entries()) {
                    if (key === 'photo') {
                        log(`üì∏ ${key}: ${value.name} (${value.size} –±–∞–π—Ç)`);
                    } else {
                        log(`üìù ${key}: ${value}`);
                    }
                }

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                fetch('/create', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    log(`üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    log(`üìÑ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(data)}`);
                    
                    if (data.success) {
                        showSuccess('‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
                        log('‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                    } else {
                        showError('‚ùå –û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                        log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(error => {
                    log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
                    showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';
                });

            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ä–º—ã: ' + error.message);
                showError('–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ä–º—ã: ' + error.message);
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('submit-btn').textContent = 'üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        log('üì± –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π');
    </script>
</body>
</html> 