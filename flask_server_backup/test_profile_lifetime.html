<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∞–Ω–∫–µ—Ç</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            background-size: 400% 400%;
            animation: starryNight 15s ease infinite;
            position: relative;
            min-height: 100vh;
        }

        @keyframes starryNight {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .test-container {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            color: #fff;
        }

        h2 {
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .feature-box {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .feature-box h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .test-btn {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
        }

        .test-btn:hover {
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
            transform: translateY(-3px) scale(1.05);
        }

        .demo-box {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .demo-box h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }

        .warning-box {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .warning-box h3 {
            color: #F44336;
            margin-bottom: 15px;
        }

        .instruction-list {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .instruction-list h3 {
            color: #FFC107;
            margin-bottom: 15px;
        }

        .instruction-list ul {
            list-style: none;
            padding: 0;
        }

        .instruction-list li {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }

        .instruction-list li:before {
            content: "‚è∞";
            position: absolute;
            left: 0;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .status-display {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>‚è∞ –¢–µ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∞–Ω–∫–µ—Ç</h2>
        
        <div class="feature-box">
            <h3>üéØ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</h3>
            <p>–î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏. –ê–Ω–∫–µ—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è.</p>
        </div>

        <div class="demo-box">
            <h3>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏</h3>
            <p><strong>–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:</strong> <code>PROFILE_LIFETIME_HOURS</code></p>
            <p><strong>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> –°—Ç—Ä–æ–∫–∞ 27 –≤ —Ñ–∞–π–ª–µ <code>app.py</code></p>
            <p><strong>–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</strong> 24 —á–∞—Å–∞</p>
            
            <div class="code-block">
# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∞–Ω–∫–µ—Ç—ã –≤ —á–∞—Å–∞—Ö - –°–¢–†–û–ö–ê 27
PROFILE_LIFETIME_HOURS = 24  # 24 —á–∞—Å–∞ = 1 –¥–µ–Ω—å
            </div>
        </div>

        <div class="warning-box">
            <h3>‚ö†Ô∏è –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</h3>
            <ul>
                <li><strong>–ê–Ω–∫–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</strong> - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</li>
                <li><strong>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</strong> - —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞</li>
                <li><strong>–õ–∞–π–∫–∏</strong> - –≤—Å–µ –ª–∞–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ª–∞–π–∫–∏ –Ω–∞ –Ω–µ–≥–æ</li>
                <li><strong>–°–æ–æ–±—â–µ–Ω–∏—è</strong> - –≤—Å–µ —á–∞—Ç—ã —Å —É—á–∞—Å—Ç–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
            </ul>
        </div>

        <div class="instruction-list">
            <h3>üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:</h3>
            <ul>
                <li>–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∞–Ω–∫–µ—Ç—É</li>
                <li>–ò–∑–º–µ–Ω–∏—Ç–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –Ω–∞ 1 —á–∞—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                <li>–ü–æ–¥–æ–∂–¥–∏—Ç–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É –≤—Ä—É—á–Ω—É—é</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–Ω–∫–µ—Ç–∞ —É–¥–∞–ª–∏–ª–∞—Å—å</li>
                <li>–í–µ—Ä–Ω–∏—Ç–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ 24 —á–∞—Å–∞</li>
            </ul>
        </div>

        <div class="feature-box">
            <h3>‚ö° –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</h3>
            <ul>
                <li><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:</strong> –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞</li>
                <li><strong>–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:</strong> API endpoint –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏</li>
                <li><strong>–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:</strong> –ê–Ω–∫–µ—Ç–∞ + —Ñ–æ—Ç–æ + –ª–∞–π–∫–∏ + —Å–æ–æ–±—â–µ–Ω–∏—è</li>
                <li><strong>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è:</strong> –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ</li>
                <li><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
            </ul>
        </div>

        <div class="demo-box">
            <h3>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏</h3>
            <ul>
                <li><strong>–ù–æ–≤–æ–µ –ø–æ–ª–µ:</strong> <code>created_at</code> –≤ –º–æ–¥–µ–ª–∏ Profile</li>
                <li><strong>–§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏:</strong> <code>cleanup_expired_profiles()</code></li>
                <li><strong>API endpoint:</strong> <code>POST /api/cleanup-profiles</code></li>
                <li><strong>–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:</strong> –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
                <li><strong>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ</li>
                <li><strong>–ü–∞–ø–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:</strong> <code>static/uploads/</code></li>
                <li><strong>–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–Ω–∫–µ—Ç—ã</li>
                <li><strong>–°–∏—Ä–æ—Ç—Å–∫–∏–µ —Ñ–∞–π–ª—ã:</strong> API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—á–∏—Å—Ç–∫–∏</li>
            </ul>
        </div>

        <div class="status-display">
            <h3>üßπ –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞</h3>
            <button class="test-btn" onclick="runCleanup()">üóëÔ∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É —Å–µ–π—á–∞—Å</button>
            <div id="cleanup-result" style="margin-top: 15px;"></div>
        </div>

        <div class="status-display">
            <h3>üì∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏</h3>
            <button class="test-btn" onclick="checkOrphanedPhotos()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Ä–æ—Ç—Å–∫–∏–µ —Ñ–æ—Ç–æ</button>
            <button class="test-btn" onclick="cleanupOrphanedPhotos()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–∏—Ä–æ—Ç—Å–∫–∏–µ —Ñ–æ—Ç–æ</button>
            <div id="photos-result" style="margin-top: 15px;"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="/create" class="test-btn">üöÄ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∞–Ω–∫–µ—Ç—É</a>
            <a href="/" class="test-btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <script>
        console.log('‚è∞ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∞–Ω–∫–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        
        function runCleanup() {
            const resultDiv = document.getElementById('cleanup-result');
            resultDiv.innerHTML = '<p>üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞...</p>';
            
            fetch('/api/cleanup-profiles', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `<p style="color: #4CAF50;">‚úÖ ${data.message}</p>`;
                    console.log('‚úÖ –û—á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ:', data);
                } else {
                    resultDiv.innerHTML = `<p style="color: #F44336;">‚ùå –û—à–∏–±–∫–∞: ${data.error}</p>`;
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏:', data.error);
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `<p style="color: #F44336;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error}</p>`;
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            });
        }

        function checkOrphanedPhotos() {
            const resultDiv = document.getElementById('photos-result');
            resultDiv.innerHTML = '<p>üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Ä–æ—Ç—Å–∫–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏...</p>';
            
            fetch('/api/check-orphaned-photos', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.orphaned_count > 0) {
                        let filesList = '<ul style="text-align: left; max-height: 200px; overflow-y: auto;">';
                        data.orphaned_photos.forEach(photo => {
                            const sizeKB = Math.round(photo.size / 1024);
                            filesList += `<li>${photo.filename} (${sizeKB} KB)</li>`;
                        });
                        filesList += '</ul>';
                        
                        resultDiv.innerHTML = `
                            <p style="color: #FF9800;">‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${data.orphaned_count} —Å–∏—Ä–æ—Ç—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤:</p>
                            ${filesList}
                        `;
                    } else {
                        resultDiv.innerHTML = `<p style="color: #4CAF50;">‚úÖ –°–∏—Ä–æ—Ç—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>`;
                    }
                    console.log('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Ä–æ—Ç—Å–∫–∏—Ö —Ñ–æ—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:', data);
                } else {
                    resultDiv.innerHTML = `<p style="color: #F44336;">‚ùå –û—à–∏–±–∫–∞: ${data.error}</p>`;
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', data.error);
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `<p style="color: #F44336;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error}</p>`;
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            });
        }

        function cleanupOrphanedPhotos() {
            const resultDiv = document.getElementById('photos-result');
            resultDiv.innerHTML = '<p>üóëÔ∏è –£–¥–∞–ª—è–µ–º —Å–∏—Ä–æ—Ç—Å–∫–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏...</p>';
            
            fetch('/api/cleanup-orphaned-photos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.deleted_count > 0) {
                        const sizeMB = Math.round(data.deleted_size / 1024 / 1024 * 100) / 100;
                        resultDiv.innerHTML = `
                            <p style="color: #4CAF50;">‚úÖ ${data.message}</p>
                            <p>–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–∞: ${sizeMB} MB</p>
                        `;
                    } else {
                        resultDiv.innerHTML = `<p style="color: #4CAF50;">‚úÖ –°–∏—Ä–æ—Ç—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>`;
                    }
                    console.log('‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å–∏—Ä–æ—Ç—Å–∫–∏—Ö —Ñ–æ—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:', data);
                } else {
                    resultDiv.innerHTML = `<p style="color: #F44336;">‚ùå –û—à–∏–±–∫–∞: ${data.error}</p>`;
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏:', data.error);
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `<p style="color: #F44336;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error}</p>`;
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            });
        }
    </script>
</body>
</html> 