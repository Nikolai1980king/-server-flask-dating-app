<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .btn {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(76,175,80,0.3);
        }
        .btn-danger {
            background: linear-gradient(90deg, #f44336 0%, #e57373 100%);
        }
        .btn-info {
            background: linear-gradient(90deg, #2196F3 0%, #64B5F6 100%);
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
        .success { background: rgba(76, 175, 80, 0.2); }
        .error { background: rgba(244, 67, 54, 0.2); }
        .info { background: rgba(33, 150, 243, 0.2); }
        .warning { background: rgba(255, 193, 7, 0.2); }
        h1, h2 { text-align: center; }
        .device-info {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîí –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º</h1>
    
    <div class="test-section">
        <h2>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h2>
        <button class="btn btn-info" onclick="showDeviceInfo()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
        <div id="device-info" class="result info" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</h2>
        <p>–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç —Å –æ–¥–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞.</p>
        
        <button class="btn" onclick="testCreateProfile()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É</button>
        <button class="btn btn-info" onclick="checkDeviceRestriction()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</button>
        <button class="btn btn-danger" onclick="clearDeviceData()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
        
        <div id="test-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <button class="btn btn-info" onclick="getDeviceStats()">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
        <div id="stats-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üîó –ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
        <a href="/" class="btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <a href="/create" class="btn">üìù –°–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É</a>
        <a href="/my_profile" class="btn">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
    </div>

    <script>
        function showDeviceInfo() {
            const deviceInfo = {
                user_agent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screen_resolution: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                cookie_enabled: navigator.cookieEnabled,
                on_line: navigator.onLine
            };

            // –°–æ–∑–¥–∞–µ–º –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
            const fingerprintData = `${deviceInfo.user_agent}|${deviceInfo.language}|gzip, deflate`;
            const fingerprint = btoa(fingerprintData).substring(0, 32); // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

            const resultDiv = document.getElementById('device-info');
            resultDiv.innerHTML = `
                <h3>üîç –û—Ç–ø–µ—á–∞—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</h3>
                <div class="device-info">${fingerprint}</div>
                <h3>üåê IP-–∞–¥—Ä–µ—Å:</h3>
                <div class="device-info">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
                <h3>üìã –î–µ—Ç–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</h3>
                <div class="device-info">${JSON.stringify(deviceInfo, null, 2)}</div>
                <h3>‚ö†Ô∏è –í–∞–∂–Ω–æ:</h3>
                <div class="device-info" style="background: rgba(255, 193, 7, 0.2);">
                    –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–æ IP-–∞–¥—Ä–µ—Å—É!<br>
                    –û–¥–∏–Ω IP = –æ–¥–Ω–∞ –∞–Ω–∫–µ—Ç–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞.
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function testCreateProfile() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div class="info">‚è≥ –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É...</div>';
            resultDiv.style.display = 'block';

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã
            fetch('/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'name': '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    'age': '25',
                    'gender': 'male',
                    'hobbies': '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã',
                    'goal': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π',
                    'venue': '–¢–µ—Å—Ç–æ–≤–æ–µ –∫–∞—Ñ–µ',
                    'latitude': '55.7558',
                    'longitude': '37.6176',
                    'venue_lat': '55.7558',
                    'venue_lng': '37.6176',
                    'terms_accepted': 'on'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –ê–Ω–∫–µ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!<br>
                            User ID: ${data.user_id}<br>
                            <a href="${data.redirect}" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—é</a>
                        </div>
                    `;
                } else {
                    if (data.redirect_url) {
                        resultDiv.innerHTML = `
                            <div class="warning">
                                ‚ö†Ô∏è ${data.error}<br>
                                <a href="${data.redirect_url}" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—Ä–æ—Ñ–∏–ª—é</a>
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="error">
                                ‚ùå ${data.error}
                            </div>
                        `;
                    }
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå –û—à–∏–±–∫–∞: ${error.message}
                    </div>
                `;
            });
        }

        function checkDeviceRestriction() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div class="info">‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è...</div>';
            resultDiv.style.display = 'block';

            // –°–æ–∑–¥–∞–µ–º –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            const deviceInfo = {
                user_agent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screen_resolution: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            const fingerprintData = `${deviceInfo.user_agent}|${deviceInfo.language}|gzip, deflate`;
            const deviceFingerprint = btoa(fingerprintData).substring(0, 32);

            fetch('/api/check-device-restriction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    device_fingerprint: deviceFingerprint,
                    device_info: deviceInfo
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.restricted) {
                    resultDiv.innerHTML = `
                        <div class="warning">
                            ‚ö†Ô∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ!<br>
                            –£–∂–µ –µ—Å—Ç—å –∞–Ω–∫–µ—Ç–∞: ${data.profile_id}<br>
                            <a href="/view_profile/${data.profile_id}" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—é</a>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ<br>
                            –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—É
                        </div>
                    `;
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}
                    </div>
                `;
            });
        }

        function clearDeviceData() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div class="info">‚è≥ –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...</div>';
            resultDiv.style.display = 'block';

            // –û—á–∏—â–∞–µ–º cookie
            document.cookie = 'user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            
            // –û—á–∏—â–∞–µ–º localStorage
            try {
                localStorage.removeItem('dating_app_user_id');
                sessionStorage.removeItem('dating_app_user_id');
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å localStorage:', e);
            }

            resultDiv.innerHTML = `
                <div class="success">
                    ‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ—á–∏—â–µ–Ω—ã<br>
                    Cookie –∏ localStorage —É–¥–∞–ª–µ–Ω—ã
                </div>
            `;
        }

        function getDeviceStats() {
            const resultDiv = document.getElementById('stats-result');
            resultDiv.innerHTML = '<div class="info">‚è≥ –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...</div>';
            resultDiv.style.display = 'block';

            fetch('/api/device-stats')
            .then(response => response.json())
            .then(data => {
                resultDiv.innerHTML = `
                    <div class="info">
                        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:<br>
                        –í—Å–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: ${data.total_devices}<br>
                        –£—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –∞–Ω–∫–µ—Ç–∞–º–∏: ${data.devices_with_profiles}<br>
                        –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleString()}
                    </div>
                `;
            })
            .catch(error => {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}
                    </div>
                `;
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            showDeviceInfo();
        };
    </script>
</body>
</html>