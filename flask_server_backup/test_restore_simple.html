<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .btn { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏</h1>
        
        <button class="btn" onclick="testRestore()">üîß –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</button>
        <button class="btn" onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
        <button class="btn" onclick="setTestData()">üìù –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        
        <div id="results"></div>
    </div>

    <script>
        function addResult(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${msg}`;
            document.getElementById('results').appendChild(div);
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function setCookie(name, value, days = 365) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value}; expires=${expires.toUTCString()}; path=/`;
        }

        function saveUserId(userId) {
            if (userId) {
                localStorage.setItem('dating_app_user_id', userId);
                sessionStorage.setItem('dating_app_user_id', userId);
            }
        }

        function getUserIdFromStorage() {
            return localStorage.getItem('dating_app_user_id') || sessionStorage.getItem('dating_app_user_id');
        }

        async function testRestore() {
            addResult('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...', 'info');
            
            const cookie = getCookie('user_id');
            const storage = getUserIdFromStorage();
            
            addResult(`üç™ Cookie: ${cookie || '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, cookie ? 'success' : 'error');
            addResult(`üíæ Storage: ${storage || '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, storage ? 'success' : 'error');
            
            const userId = cookie || storage;
            
            if (userId) {
                addResult(`‚úÖ –ù–∞–π–¥–µ–Ω user_id: ${userId}`, 'success');
                
                try {
                    addResult('üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ API...', 'info');
                    const response = await fetch(`/api/check-profile/${userId}`);
                    const data = await response.json();
                    
                    addResult(`üìä –û—Ç–≤–µ—Ç API: ${JSON.stringify(data)}`, 'info');
                    
                    if (data.exists) {
                        addResult('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞–π–¥–µ–Ω!', 'success');
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é
                        setCookie('user_id', userId);
                        saveUserId(userId);
                        addResult('üíæ –°–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        setTimeout(() => {
                            addResult('üîÑ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...', 'info');
                            window.location.href = '/';
                        }, 1000);
                        
                    } else {
                        addResult('‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ', 'error');
                    }
                } catch (error) {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ API: ${error}`, 'error');
                }
            } else {
                addResult('‚ùå User ID –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            }
        }

        function clearAll() {
            localStorage.removeItem('dating_app_user_id');
            sessionStorage.removeItem('dating_app_user_id');
            document.cookie = 'user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            addResult('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        function setTestData() {
            const testId = '1cf59a5f-8971-41bc-bf8b-ce6348724c27';
            saveUserId(testId);
            setCookie('user_id', testId);
            addResult(`üìù –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ${testId}`, 'success');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            const cookie = getCookie('user_id');
            const storage = getUserIdFromStorage();
            addResult(`üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - Cookie: ${cookie || '–Ω–µ—Ç'}, Storage: ${storage || '–Ω–µ—Ç'}`, 'info');
        };
    </script>
</body>
</html> 