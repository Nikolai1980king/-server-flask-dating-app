<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 25px;
            font-size: 2em;
            text-align: center;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn:hover {
            box-shadow: 0 4px 16px rgba(76,175,80,0.3);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(90deg, #2196F3 0%, #64B5F6 100%);
        }

        .btn-warning {
            background: linear-gradient(90deg, #FF9800 0%, #FFB74D 100%);
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            color: #333;
        }

        .distance-display {
            background: linear-gradient(135deg, #4CAF50 0%, #81c784 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            display: none;
        }

        .status {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: #333;
            text-align: center;
            font-weight: bold;
        }

        .selected-object {
            background: linear-gradient(135deg, #4CAF50 0%, #81c784 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß≠ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</h1>
        
        <div id="map"></div>
        
        <div class="controls">
            <button type="button" class="btn btn-secondary" onclick="getCurrentLocation()">
                üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
            </button>
            <button type="button" class="btn btn-warning" onclick="createTestObjects()">
                üè™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
            </button>
            <button type="button" class="btn" onclick="calculateDistance()" id="calculate-btn" disabled>
                üìè –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
            </button>
            <button type="button" class="btn btn-warning" onclick="clearAll()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
            </button>
        </div>

        <div class="status" id="status">
            üîÑ –û–∂–∏–¥–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...
        </div>

        <div class="selected-object" id="selected-object">
            –í—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç: <span id="selected-name">-</span>
        </div>

        <div class="distance-display" id="distance-display">
            <div>üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –æ–±—ä–µ–∫—Ç–∞:</div>
            <div id="distance-value">-</div>
        </div>

        <div class="info-panel">
            <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏:</h3>
            <div><strong>–í–∞—à–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> <span id="user-coords">–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã</span></div>
            <div><strong>–í—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç:</strong> <span id="object-info">–ù–µ –≤—ã–±—Ä–∞–Ω</span></div>
            <div><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞:</strong> <span id="object-coords">-</span></div>
        </div>
    </div>

    <script>
        let myMap;
        let userLocation = null;
        let selectedObject = null;
        let userPlacemark = null;
        let selectedPlacemark = null;
        let distanceLine = null;
        let testObjects = [];

        function initMap() {
            ymaps.ready(function () {
                myMap = new ymaps.Map('map', {
                    center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞
                    zoom: 12,
                    controls: ['zoomControl', 'fullscreenControl', 'geolocationControl']
                });
                console.log('‚úÖ –ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            });
        }

        function getCurrentLocation() {
            const statusDiv = document.getElementById('status');
            const calculateBtn = document.getElementById('calculate-btn');
            
            statusDiv.textContent = 'üìç –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–∞—Ä—Ç—É
                        if (userPlacemark) {
                            myMap.geoObjects.remove(userPlacemark);
                        }
                        
                        userPlacemark = new ymaps.Placemark([userLocation.lat, userLocation.lng], {
                            balloonContent: 'üìç –í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'
                        }, {
                            preset: 'islands#blueDotIcon',
                            iconColor: '#2196F3'
                        });
                        
                        myMap.geoObjects.add(userPlacemark);
                        myMap.setCenter([userLocation.lat, userLocation.lng], 15);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                        document.getElementById('user-coords').textContent = 
                            userLocation.lat.toFixed(6) + ', ' + userLocation.lng.toFixed(6);
                        document.getElementById('status').textContent = '‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!';
                        
                        // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
                        if (selectedObject) {
                            calculateBtn.disabled = false;
                        }
                        
                        console.log('‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ:', userLocation);
                    },
                    function(error) {
                        statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è';
                        console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                statusDiv.textContent = '‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            }
        }

        function createTestObjects() {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
            testObjects.forEach(function(obj) {
                myMap.geoObjects.remove(obj);
            });
            testObjects = [];

            const center = myMap.getCenter();
            const objects = [
                {
                    name: '–ö–∞—Ñ–µ "–£—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ"',
                    type: 'cafe',
                    lat: center[0] + 0.002,
                    lng: center[1] + 0.002
                },
                {
                    name: '–†–µ—Å—Ç–æ—Ä–∞–Ω "–í–∫—É—Å–Ω–∞—è –µ–¥–∞"',
                    type: 'restaurant',
                    lat: center[0] - 0.002,
                    lng: center[1] + 0.003
                },
                {
                    name: '–ö–æ—Ñ–µ–π–Ω—è "–ê—Ä–æ–º–∞—Ç"',
                    type: 'coffee',
                    lat: center[0] + 0.003,
                    lng: center[1] - 0.002
                },
                {
                    name: '–ü–∏—Ü—Ü–µ—Ä–∏—è "–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è"',
                    type: 'pizza',
                    lat: center[0] - 0.001,
                    lng: center[1] - 0.003
                }
            ];

            objects.forEach(function(obj) {
                const placemark = new ymaps.Placemark([obj.lat, obj.lng], {
                    balloonContent: '<div style="padding: 10px;"><h3>' + obj.name + '</h3><p>–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p></div>'
                }, {
                    preset: 'islands#redDotIcon',
                    iconColor: '#FF5722'
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                placemark.events.add('click', function() {
                    selectObject(obj, placemark);
                });

                myMap.geoObjects.add(placemark);
                testObjects.push(placemark);
            });

            document.getElementById('status').textContent = '‚úÖ –°–æ–∑–¥–∞–Ω–æ ' + objects.length + ' —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤! –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞.';
            console.log('‚úÖ –°–æ–∑–¥–∞–Ω–æ ' + objects.length + ' —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤');
        }

        function selectObject(obj, placemark) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            if (selectedPlacemark) {
                selectedPlacemark.options.set('preset', 'islands#redDotIcon');
                selectedPlacemark.options.set('iconColor', '#FF5722');
            }

            // –í—ã–¥–µ–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∑–µ–ª–µ–Ω—ã–º —Ü–≤–µ—Ç–æ–º
            placemark.options.set('preset', 'islands#greenDotIcon');
            placemark.options.set('iconColor', '#4CAF50');

            selectedObject = obj;
            selectedPlacemark = placemark;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ
            document.getElementById('selected-name').textContent = obj.name;
            document.getElementById('object-info').textContent = obj.name;
            document.getElementById('object-coords').textContent = obj.lat.toFixed(6) + ', ' + obj.lng.toFixed(6);
            document.getElementById('selected-object').style.display = 'block';

            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (userLocation) {
                document.getElementById('calculate-btn').disabled = false;
            }

            document.getElementById('status').textContent = '‚úÖ –í—ã–±—Ä–∞–Ω –æ–±—ä–µ–∫—Ç: ' + obj.name;
            console.log('‚úÖ –í—ã–±—Ä–∞–Ω –æ–±—ä–µ–∫—Ç:', obj);
        }

        function calculateDistance() {
            if (!userLocation || !selectedObject) {
                alert('‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã–±—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç!');
                return;
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –≥–∞–≤–µ—Ä—Å–∏–Ω—É—Å–∞
            const distance = calculateHaversineDistance(
                userLocation.lat, userLocation.lng,
                selectedObject.lat, selectedObject.lng
            );

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
            const distanceDisplay = document.getElementById('distance-display');
            const distanceValue = document.getElementById('distance-value');
            
            distanceValue.textContent = distance.toFixed(2) + ' –∫–º';
            distanceDisplay.style.display = 'block';

            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é –Ω–∞ –∫–∞—Ä—Ç–µ
            drawDistanceLine();

            document.getElementById('status').textContent = '‚úÖ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ: ' + distance.toFixed(2) + ' –∫–º';
            console.log('‚úÖ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ:', distance.toFixed(2), '–∫–º');
        }

        function calculateHaversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function drawDistanceLine() {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ª–∏–Ω–∏—é
            if (distanceLine) {
                myMap.geoObjects.remove(distanceLine);
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ª–∏–Ω–∏—é
            distanceLine = new ymaps.Polyline([
                [userLocation.lat, userLocation.lng],
                [selectedObject.lat, selectedObject.lng]
            ], {
                balloonContent: '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + calculateHaversineDistance(
                    userLocation.lat, userLocation.lng,
                    selectedObject.lat, selectedObject.lng
                ).toFixed(2) + ' –∫–º'
            }, {
                strokeColor: '#FF5722',
                strokeWidth: 3,
                strokeOpacity: 0.8
            });

            myMap.geoObjects.add(distanceLine);
        }

        function clearAll() {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã
            if (userPlacemark) {
                myMap.geoObjects.remove(userPlacemark);
                userPlacemark = null;
            }
            if (selectedPlacemark) {
                myMap.geoObjects.remove(selectedPlacemark);
                selectedPlacemark = null;
            }
            if (distanceLine) {
                myMap.geoObjects.remove(distanceLine);
                distanceLine = null;
            }
            testObjects.forEach(function(obj) {
                myMap.geoObjects.remove(obj);
            });
            testObjects = [];

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            userLocation = null;
            selectedObject = null;

            // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('status').textContent = 'üîÑ –û–∂–∏–¥–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...';
            document.getElementById('user-coords').textContent = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã';
            document.getElementById('object-info').textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω';
            document.getElementById('object-coords').textContent = '-';
            document.getElementById('selected-object').style.display = 'none';
            document.getElementById('distance-display').style.display = 'none';
            document.getElementById('calculate-btn').disabled = true;

            console.log('‚úÖ –í—Å–µ –æ–±—ä–µ–∫—Ç—ã –æ—á–∏—â–µ–Ω—ã');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html> 