<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ç–æ—Ä–æ–π –∞–Ω–∫–µ—Ç—ã</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            background-size: 400% 400%;
            animation: starryNight 15s ease infinite;
            position: relative;
            min-height: 100vh;
        }

        @keyframes starryNight {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .test-container {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            color: #fff;
        }

        h2 {
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .problem-box {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .problem-box h3 {
            color: #F44336;
            margin-bottom: 15px;
        }

        .solution-box {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .solution-box h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .test-btn {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
        }

        .test-btn:hover {
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
            transform: translateY(-3px) scale(1.05);
        }

        .info-box {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .info-box h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .status-display {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –í—Ç–æ—Ä–∞—è –∞–Ω–∫–µ—Ç–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è</h2>
        
        <div class="problem-box">
            <h3>üö® –ü—Ä–æ–±–ª–µ–º–∞</h3>
            <p>–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä—É—é –∞–Ω–∫–µ—Ç—É —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∞–Ω–∫–µ—Ç—ã.</p>
        </div>

        <div class="info-box">
            <h3>üîç –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã</h3>
            <p>–í –∫–æ–¥–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å, –µ—Å–ª–∏ —É –Ω–µ–≥–æ —É–∂–µ –µ—Å—Ç—å –∞–Ω–∫–µ—Ç–∞:</p>
            
            <div class="code-block">
@app.route('/create', methods=['GET', 'POST'])
def create_profile():
    user_id = request.cookies.get('user_id')
    if not user_id:
        user_id = str(uuid.uuid4())
    if Profile.query.get(user_id):  # ‚Üê –ü–†–û–ë–õ–ï–ú–ê –ó–î–ï–°–¨
        return redirect(url_for('my_profile'))  # ‚Üê –ü–ï–†–ï–ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï
            </div>
            
            <p>–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å cookie —Å user_id –∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –µ—Å—Ç—å –∞–Ω–∫–µ—Ç–∞ —Å —ç—Ç–∏–º ID, —Ç–æ –æ–Ω –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è.</p>
        </div>

        <div class="solution-box">
            <h3>üí° –†–µ—à–µ–Ω–∏—è</h3>
            <ul>
                <li><strong>–û—á–∏—Å—Ç–∏—Ç—å cookie:</strong> –£–¥–∞–ª–∏—Ç—å user_id –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞</li>
                <li><strong>–£–¥–∞–ª–∏—Ç—å –∞–Ω–∫–µ—Ç—É:</strong> –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–Ω–∫–µ—Ç—É –∏–∑ –±–∞–∑—ã</li>
                <li><strong>–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É:</strong> –†–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–Ω–∫–µ—Ç</li>
                <li><strong>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é":</strong> –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –Ω–æ–≤–æ–π –∞–Ω–∫–µ—Ç—ã</li>
            </ul>
        </div>

        <div class="status-display">
            <h3>üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
            <button class="test-btn" onclick="checkCurrentUser()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button class="test-btn" onclick="clearUserCookie()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å cookie –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button class="test-btn" onclick="checkDatabase()">üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</button>
            <div id="diagnostic-result" style="margin-top: 15px;"></div>
        </div>

        <div class="info-box">
            <h3>üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
            <p><strong>–®–∞–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong></p>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞</li>
                <li>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∞–Ω–∫–µ—Ç—É</li>
                <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä—É—é –∞–Ω–∫–µ—Ç—É</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç</li>
            </ol>
            
            <p><strong>–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:</strong></p>
            <ul>
                <li>‚úÖ –ü–µ—Ä–≤–∞—è –∞–Ω–∫–µ—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ</li>
                <li>‚ùå –í—Ç–æ—Ä–∞—è –∞–Ω–∫–µ—Ç–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)</li>
            </ul>
        </div>

        <div class="solution-box">
            <h3>üîß –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ</h3>
            <p>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ç–æ—Ä–æ–π –∞–Ω–∫–µ—Ç—ã –Ω—É–∂–Ω–æ:</p>
            <ol>
                <li>–û—á–∏—Å—Ç–∏—Ç—å cookie user_id –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
                <li>–ò–ª–∏ —É–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–Ω–∫–µ—Ç—É –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</li>
                <li>–ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ –∫–æ–¥–µ</li>
            </ol>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="/create" class="test-btn">üöÄ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É</a>
            <a href="/" class="test-btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <script>
        console.log('üîç –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—Ç–æ—Ä–æ–π –∞–Ω–∫–µ—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        
        function checkCurrentUser() {
            const resultDiv = document.getElementById('diagnostic-result');
            resultDiv.innerHTML = '<p>üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</p>';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookie
            const cookies = document.cookie.split(';');
            let userCookie = null;
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'user_id') {
                    userCookie = value;
                    break;
                }
            }
            
            if (userCookie) {
                resultDiv.innerHTML = `
                    <p style="color: #FF9800;">‚ö†Ô∏è –ù–∞–π–¥–µ–Ω cookie user_id: ${userCookie}</p>
                    <p>–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–Ω–∫–µ—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
                    <p>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∞–Ω–∫–µ—Ç—ã –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç cookie.</p>
                `;
            } else {
                resultDiv.innerHTML = `
                    <p style="color: #4CAF50;">‚úÖ Cookie user_id –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
                    <p>–í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∫–µ—Ç—É.</p>
                `;
            }
        }
        
        function clearUserCookie() {
            const resultDiv = document.getElementById('diagnostic-result');
            resultDiv.innerHTML = '<p>üóëÔ∏è –û—á–∏—â–∞–µ–º cookie –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</p>';
            
            // –£–¥–∞–ª—è–µ–º cookie user_id
            document.cookie = 'user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            
            resultDiv.innerHTML = `
                <p style="color: #4CAF50;">‚úÖ Cookie user_id –æ—á–∏—â–µ–Ω</p>
                <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∫–µ—Ç—É.</p>
            `;
            
            console.log('üóëÔ∏è Cookie user_id –æ—á–∏—â–µ–Ω');
        }
        
        function checkDatabase() {
            const resultDiv = document.getElementById('diagnostic-result');
            resultDiv.innerHTML = '<p>üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...</p>';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookie
            const cookies = document.cookie.split(';');
            let userCookie = null;
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'user_id') {
                    userCookie = value;
                    break;
                }
            }
            
            if (userCookie) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–Ω–∫–µ—Ç–∞ –≤ –±–∞–∑–µ
                fetch(`/api/check-profile/${userCookie}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.exists) {
                            resultDiv.innerHTML = `
                                <p style="color: #F44336;">‚ùå –ê–Ω–∫–µ—Ç–∞ —Å ID ${userCookie} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ</p>
                                <p>–≠—Ç–æ –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—á–µ–º—É –≤—Ç–æ—Ä–∞—è –∞–Ω–∫–µ—Ç–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è.</p>
                            `;
                        } else {
                            resultDiv.innerHTML = `
                                <p style="color: #4CAF50;">‚úÖ –ê–Ω–∫–µ—Ç–∞ —Å ID ${userCookie} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∞–∑–µ</p>
                                <p>–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∫–µ—Ç—É.</p>
                            `;
                        }
                    })
                    .catch(error => {
                        resultDiv.innerHTML = `
                            <p style="color: #FF9800;">‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</p>
                            <p>–û—à–∏–±–∫–∞: ${error}</p>
                        `;
                    });
            } else {
                resultDiv.innerHTML = `
                    <p style="color: #4CAF50;">‚úÖ Cookie user_id –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
                    <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è.</p>
                `;
            }
        }
    </script>
</body>
</html> 