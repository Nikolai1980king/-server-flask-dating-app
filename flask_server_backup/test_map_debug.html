<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–µ—Å—Ç –∫–∞—Ä—Ç—ã</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        #map { 
            width: 100%; 
            height: 400px; 
            border: 2px solid #ccc;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∫–∞—Ä—Ç—ã –Ø–Ω–¥–µ–∫—Å</h1>
    
    <div id="status" class="status info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <button onclick="initMap()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
    <button onclick="checkYmaps()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ymaps</button>
    <button onclick="getLocation()">–ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</button>
    
    <div id="map"></div>
    
    <div id="debug-info"></div>

    <script>
        let myMap = null;
        let myPlacemark = null;
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function addDebugInfo(info) {
            const debug = document.getElementById('debug-info');
            const div = document.createElement('div');
            div.style.padding = '5px';
            div.style.margin = '2px 0';
            div.style.backgroundColor = '#f8f9fa';
            div.style.borderLeft = '3px solid #007bff';
            div.textContent = new Date().toLocaleTimeString() + ': ' + info;
            debug.appendChild(div);
        }
        
        function checkYmaps() {
            addDebugInfo('–ü—Ä–æ–≤–µ—Ä–∫–∞ ymaps...');
            
            if (typeof ymaps === 'undefined') {
                updateStatus('‚ùå ymaps –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                addDebugInfo('ymaps –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                return false;
            }
            
            updateStatus('‚úÖ ymaps –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
            addDebugInfo('ymaps –æ–ø—Ä–µ–¥–µ–ª–µ–Ω: ' + typeof ymaps);
            addDebugInfo('ymaps.ready: ' + typeof ymaps.ready);
            
            return true;
        }
        
        function initMap() {
            addDebugInfo('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...');
            
            if (!checkYmaps()) {
                return;
            }
            
            try {
                ymaps.ready(function () {
                    addDebugInfo('ymaps.ready –≤—ã–ø–æ–ª–Ω–µ–Ω');
                    
                    try {
                        myMap = new ymaps.Map('map', {
                            center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞
                            zoom: 10,
                            controls: ['zoomControl', 'fullscreenControl']
                        });
                        
                        updateStatus('‚úÖ –ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'success');
                        addDebugInfo('–ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É
                        myPlacemark = new ymaps.Placemark([55.76, 37.64], {
                            balloonContent: '–¢–µ—Å—Ç–æ–≤–∞—è –º–µ—Ç–∫–∞'
                        }, {
                            preset: 'islands#redDotIcon'
                        });
                        
                        myMap.geoObjects.add(myPlacemark);
                        addDebugInfo('–ú–µ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                        
                    } catch (mapError) {
                        updateStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã: ' + mapError.message, 'error');
                        addDebugInfo('–û—à–∏–±–∫–∞ –∫–∞—Ä—Ç—ã: ' + mapError.message);
                    }
                });
                
            } catch (readyError) {
                updateStatus('‚ùå –û—à–∏–±–∫–∞ ymaps.ready: ' + readyError.message, 'error');
                addDebugInfo('–û—à–∏–±–∫–∞ ymaps.ready: ' + readyError.message);
            }
        }
        
        function getLocation() {
            addDebugInfo('–ó–∞–ø—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏...');
            
            if (!navigator.geolocation) {
                updateStatus('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                addDebugInfo('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    updateStatus(`‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${lat.toFixed(6)}, ${lng.toFixed(6)}`, 'success');
                    addDebugInfo(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${lat}, ${lng}`);
                    
                    if (myMap) {
                        myMap.setCenter([lat, lng], 15);
                        addDebugInfo('–ö–∞—Ä—Ç–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –≤–∞—à–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏');
                    }
                },
                function(error) {
                    updateStatus('‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ' + error.message, 'error');
                    addDebugInfo('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ' + error.message);
                },
                {
                    enableHighAccuracy: false,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            addDebugInfo('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º ymaps —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                checkYmaps();
            }, 2000);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                initMap();
            }, 3000);
        };
    </script>
</body>
</html> 