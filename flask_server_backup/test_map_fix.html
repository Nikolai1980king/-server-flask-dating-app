<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç –∫–∞—Ä—Ç—ã - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        #map {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border: 2px solid #ccc;
            border-radius: 10px;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è –¢–µ—Å—Ç –∫–∞—Ä—Ç—ã - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</h1>
        <p><strong>–ë–µ–∑ API –∫–ª—é—á–∞</strong> - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π URL</p>
        
        <div id="status" class="status info">
            <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status-text">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏...</span>
        </div>
        
        <div id="map"></div>
        
        <div style="margin: 20px 0;">
            <button onclick="testMap()" class="btn btn-primary">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
            <button onclick="getLocation()" class="btn btn-success">üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
            <button onclick="addTestCafe()" class="btn btn-warning">üè™ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∫–∞—Ñ–µ</button>
        </div>
        
        <div id="console-output" style="background: #000; color: #0f0; padding: 15px; border-radius: 8px; font-family: monospace; max-height: 300px; overflow-y: auto;">
            <strong>–ö–æ–Ω—Å–æ–ª—å:</strong><br>
            <span id="console-text">–û–∂–∏–¥–∞–Ω–∏–µ –ª–æ–≥–æ–≤...</span>
        </div>
    </div>

    <script>
        var myMap = null;
        var myPlacemark = null;
        var consoleOutput = document.getElementById('console-text');
        var statusElement = document.getElementById('status');
        var statusText = document.getElementById('status-text');
        
        function log(message) {
            var timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += '[' + timestamp + '] ' + message + '<br>';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type) {
            statusText.textContent = message;
            statusElement.className = 'status ' + type;
        }
        
        function testMap() {
            log('üß™ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –∫–∞—Ä—Ç—ã...');
            
            if (typeof ymaps === 'undefined') {
                log('‚ùå Yandex Maps API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                updateStatus('Yandex Maps API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }
            
            log('‚úÖ Yandex Maps API –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            try {
                ymaps.ready(function () {
                    log('‚úÖ ymaps.ready() –≤—ã–ø–æ–ª–Ω–µ–Ω');
                    
                    try {
                        myMap = new ymaps.Map('map', {
                            center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞
                            zoom: 10,
                            controls: ['zoomControl', 'fullscreenControl']
                        });
                        
                        log('‚úÖ –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                        updateStatus('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                        myMap.events.add('click', function (e) {
                            var coords = e.get('coords');
                            log('üìç –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ: ' + coords[0] + ', ' + coords[1]);
                            setLocation(coords[0], coords[1]);
                        });
                        
                        log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω');
                        
                    } catch (error) {
                        log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç—ã: ' + error.message);
                        updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç—ã: ' + error.message, 'error');
                    }
                });
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –≤ ymaps.ready(): ' + error.message);
                updateStatus('–û—à–∏–±–∫–∞ –≤ ymaps.ready(): ' + error.message, 'error');
            }
        }
        
        function setLocation(lat, lng) {
            log('üìç –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: ' + lat + ', ' + lng);
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–µ—Ç–∫—É
            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
            myPlacemark = new ymaps.Placemark([lat, lng], {
                balloonContent: '–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'
            }, {
                preset: 'islands#blueDotIcon'
            });
            
            myMap.geoObjects.add(myPlacemark);
            myMap.setCenter([lat, lng], 15);
            
            log('‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            updateStatus('–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ' + lat + ', ' + lng, 'success');
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                log('üìç –ó–∞–ø—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏...');
                updateStatus('–ó–∞–ø—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏...', 'info');
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        log('‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞: ' + lat + ', ' + lng);
                        setLocation(lat, lng);
                    },
                    function(error) {
                        log('‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ' + error.message);
                        updateStatus('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ' + error.message, 'error');
                    }
                );
            } else {
                log('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                updateStatus('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
            }
        }
        
        function addTestCafe() {
            if (!myMap) {
                log('‚ùå –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                updateStatus('–ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'error');
                return;
            }
            
            var center = myMap.getCenter();
            var cafeCoords = [center[0] + 0.001, center[1] + 0.001];
            
            var cafePlacemark = new ymaps.Placemark(cafeCoords, {
                balloonContent: '<strong>–ö–∞—Ñ–µ "–¢–µ—Å—Ç–æ–≤–æ–µ"</strong><br>–¢–µ—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å<br><button onclick="selectCafe()" style="margin-top: 5px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">–í—ã–±—Ä–∞—Ç—å —ç—Ç–æ –∫–∞—Ñ–µ</button>'
            }, {
                preset: 'islands#blueDotIcon',
                iconColor: '#ff6b6b'
            });
            
            myMap.geoObjects.add(cafePlacemark);
            log('üè™ –¢–µ—Å—Ç–æ–≤–æ–µ –∫–∞—Ñ–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            updateStatus('–¢–µ—Å—Ç–æ–≤–æ–µ –∫–∞—Ñ–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ', 'success');
        }
        
        function selectCafe() {
            log('‚úÖ –ö–∞—Ñ–µ –≤—ã–±—Ä–∞–Ω–æ!');
            updateStatus('–ö–∞—Ñ–µ –≤—ã–±—Ä–∞–Ω–æ!', 'success');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateStatus('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –æ–∂–∏–¥–∞–Ω–∏–µ API...', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É API –∫–∞–∂–¥—ã–µ 500–º—Å
            var checkInterval = setInterval(function() {
                if (typeof ymaps !== 'undefined') {
                    clearInterval(checkInterval);
                    log('‚úÖ Yandex Maps API –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                    updateStatus('API –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç...', 'info');
                    setTimeout(testMap, 1000);
                } else {
                    log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ Yandex Maps API...');
                }
            }, 500);
            
            // –¢–∞–π–º–∞—É—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                clearInterval(checkInterval);
                if (typeof ymaps === 'undefined') {
                    log('‚ùå –¢–∞–π–º–∞—É—Ç: Yandex Maps API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∑–∞ 10 —Å–µ–∫—É–Ω–¥');
                    updateStatus('–¢–∞–π–º–∞—É—Ç: API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                }
            }, 10000);
        };
    </script>
</body>
</html> 