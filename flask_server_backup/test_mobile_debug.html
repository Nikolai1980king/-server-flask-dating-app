<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f0f0f0;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        #log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏</h1>
    
    <div class="debug-section">
        <h2>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h2>
        <div id="device-info"></div>
    </div>

    <div class="debug-section">
        <h2>üç™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏</h2>
        <button class="button" onclick="checkSessionData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button class="button" onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
        <div id="session-info"></div>
    </div>

    <div class="debug-section">
        <h2>üîÑ –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</h2>
        <button class="button" onclick="testRestore()">–¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</button>
        <button class="button" onclick="testAPI()">–¢–µ—Å—Ç API</button>
        <div id="restore-info"></div>
    </div>

    <div class="debug-section">
        <h2>üìä –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <button class="button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <div id="log"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#28a745' : 
                         type === 'error' ? '#dc3545' : 
                         type === 'warning' ? '#ffc107' : '#17a2b8';
            
            logDiv.innerHTML += `<div style="color: ${color}; margin: 5px 0;">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function setCookie(name, value, days = 365) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value}; expires=${expires.toUTCString()}; path=/`;
        }

        function saveUserId(userId) {
            if (userId) {
                localStorage.setItem('dating_app_user_id', userId);
                sessionStorage.setItem('dating_app_user_id', userId);
            }
        }

        function getUserIdFromStorage() {
            return localStorage.getItem('dating_app_user_id') || sessionStorage.getItem('dating_app_user_id');
        }

        function checkDeviceInfo() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const userAgent = navigator.userAgent;
            const screenSize = `${screen.width}x${screen.height}`;
            const viewport = `${window.innerWidth}x${window.innerHeight}`;
            
            const deviceInfo = document.getElementById('device-info');
            deviceInfo.innerHTML = `
                <p><strong>–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> <span class="${isMobile ? 'success' : 'info'}">${isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ' : '–î–µ—Å–∫—Ç–æ–ø–Ω–æ–µ'}</span></p>
                <p><strong>–†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞:</strong> ${screenSize}</p>
                <p><strong>–†–∞–∑–º–µ—Ä viewport:</strong> ${viewport}</p>
                <p><strong>User Agent:</strong> ${userAgent.substring(0, 100)}...</p>
                <p><strong>localStorage –¥–æ—Å—Ç—É–ø–µ–Ω:</strong> <span class="${typeof(Storage) !== "undefined" ? 'success' : 'error'}">${typeof(Storage) !== "undefined" ? '–î–∞' : '–ù–µ—Ç'}</span></p>
                <p><strong>sessionStorage –¥–æ—Å—Ç—É–ø–µ–Ω:</strong> <span class="${typeof(Storage) !== "undefined" ? 'success' : 'error'}">${typeof(Storage) !== "undefined" ? '–î–∞' : '–ù–µ—Ç'}</span></p>
            `;
            
            log(`üì± –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ' : '–î–µ—Å–∫—Ç–æ–ø–Ω–æ–µ'}`, 'info');
            log(`üìè –†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞: ${screenSize}`, 'info');
            log(`üîç User Agent: ${userAgent.substring(0, 50)}...`, 'info');
        }

        function checkSessionData() {
            const cookie = getCookie('user_id');
            const storage = getUserIdFromStorage();
            
            const sessionInfo = document.getElementById('session-info');
            sessionInfo.innerHTML = `
                <p><strong>Cookie user_id:</strong> <span class="${cookie ? 'success' : 'warning'}">${cookie || '–Ω–µ –Ω–∞–π–¥–µ–Ω'}</span></p>
                <p><strong>localStorage user_id:</strong> <span class="${storage ? 'success' : 'warning'}">${storage || '–Ω–µ –Ω–∞–π–¥–µ–Ω'}</span></p>
                <p><strong>–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ:</strong> <span class="${cookie === storage ? 'success' : 'error'}">${cookie === storage ? '‚úÖ' : '‚ùå'}</span></p>
            `;
            
            log(`üç™ Cookie: ${cookie || '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, cookie ? 'success' : 'warning');
            log(`üíæ localStorage: ${storage || '–Ω–µ –Ω–∞–π–¥–µ–Ω'}`, storage ? 'success' : 'warning');
        }

        function clearAllData() {
            document.cookie = 'user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            localStorage.removeItem('dating_app_user_id');
            sessionStorage.removeItem('dating_app_user_id');
            
            log('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
            checkSessionData();
        }

        async function testRestore() {
            log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...', 'info');
            
            const cookie = getCookie('user_id');
            const storage = getUserIdFromStorage();
            const userId = cookie || storage;
            
            if (!userId) {
                log('‚ùå –ù–µ—Ç User ID –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è', 'warning');
                return;
            }
            
            try {
                log(`üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è ID: ${userId}`, 'info');
                const response = await fetch(`/api/check-profile/${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    if (data.exists) {
                        log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞–π–¥–µ–Ω!', 'success');
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é
                        setCookie('user_id', userId);
                        saveUserId(userId);
                        
                        log('üíæ –°–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ñ–∏–ª–µ
                        const restoreInfo = document.getElementById('restore-info');
                        restoreInfo.innerHTML = `
                            <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0;">
                                <h3>‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!</h3>
                                <p><strong>ID:</strong> ${userId}</p>
                                <p><strong>–ò–º—è:</strong> ${data.profile_data.name}</p>
                                <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${data.profile_data.age}</p>
                                <p><strong>–ì–æ—Ä–æ–¥:</strong> ${data.profile_data.city || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                                <button class="button" onclick="window.location.href='/my_profile'">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—é</button>
                            </div>
                        `;
                        
                    } else {
                        log('‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ', 'error');
                        const restoreInfo = document.getElementById('restore-info');
                        restoreInfo.innerHTML = `
                            <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;">
                                <h3>‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</h3>
                                <p>–ü—Ä–æ—Ñ–∏–ª—å —Å ID ${userId} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p>
                                <button class="button" onclick="window.location.href='/create'">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∫–µ—Ç—É</button>
                            </div>
                        `;
                    }
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ API: ${data.error}`, 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function testAPI() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º API endpoints...', 'info');
            
            try {
                // –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
                const response = await fetch('/api/check-profile/test123');
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ API /api/check-profile —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    log('‚ùå API /api/check-profile –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                }
                
                // –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
                const profilesResponse = await fetch('/api/profiles');
                const profilesData = await profilesResponse.json();
                
                if (profilesData.success) {
                    log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∫–µ—Ç –≤ –±–∞–∑–µ: ${profilesData.count}`, 'info');
                } else {
                    log('‚ùå API /api/profiles –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('üìù –õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            checkDeviceInfo();
            checkSessionData();
            testAPI();
        };
    </script>
</body>
</html> 