<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª–ª—É–Ω–∞</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            background-size: 400% 400%;
            animation: starryNight 15s ease infinite;
            position: relative;
            min-height: 100vh;
        }

        @keyframes starryNight {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInOut {
            0% { opacity: 0; top: 0; }
            10% { opacity: 1; top: 80px; }
            90% { opacity: 1; top: 80px; }
            100% { opacity: 0; top: 0; }
        }

        .form-container {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h2 {
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        input { 
            width: 100%; 
            padding: 12px; 
            margin: 10px 0; 
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #333;
            font-size: 1em;
        }

        .map-container {
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        #map {
            width: 100%;
            height: 400px;
            border-radius: 15px;
        }

        .test-info {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #fff;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #fff;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .log-success {
            background: rgba(76, 175, 80, 0.2);
            border-left: 3px solid #4CAF50;
        }

        .log-error {
            background: rgba(244, 67, 54, 0.2);
            border-left: 3px solid #f44336;
        }

        .log-info {
            background: rgba(33, 150, 243, 0.2);
            border-left: 3px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>üß™ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª–ª—É–Ω–∞</h2>
        
        <div class="test-info">
            <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
            1. –ù–∞ –∫–∞—Ä—Ç–µ –Ω–∞–π–¥–∏—Ç–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ (–∫–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –±–∞—Ä)<br>
            2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è<br>
            3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –±–∞–ª–ª—É–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª<br>
            4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∏–∂–µ
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <input type="text" name="venue" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è (–∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ)" id="venue-input">

        <div class="test-info">
            <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status">–û–∂–∏–¥–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ –∑–∞–≤–µ–¥–µ–Ω–∏—é...</span>
        </div>

        <div class="log-container">
            <strong>–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π:</strong>
            <div id="log"></div>
        </div>
    </div>

    <script>
        let myMap;

        function initMap() {
            ymaps.ready(function () {
                myMap = new ymaps.Map('map', {
                    center: [55.7558, 37.6176], // –ú–æ—Å–∫–≤–∞
                    zoom: 15,
                    controls: ['zoomControl', 'fullscreenControl']
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º –Ω–∞ –∫–∞—Ä—Ç–µ
                myMap.events.add('click', function (e) {
                    var coords = e.get('coords');
                    updateStatus(`–ö–ª–∏–∫ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º: ${coords[0].toFixed(4)}, ${coords[1].toFixed(4)}`);
                    addLog(`–ö–ª–∏–∫ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º: ${coords[0].toFixed(4)}, ${coords[1].toFixed(4)}`, 'info');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–±—ä–µ–∫—Ç –≤ —Ç–æ—á–∫–µ –∫–ª–∏–∫–∞
                    myMap.geoObjects.each(function (geoObject) {
                        if (geoObject.geometry && geoObject.geometry.getCoordinates) {
                            var objCoords = geoObject.geometry.getCoordinates();
                            var distance = Math.sqrt(
                                Math.pow(coords[0] - objCoords[0], 2) + 
                                Math.pow(coords[1] - objCoords[1], 2)
                            );
                            
                            // –ï—Å–ª–∏ –∫–ª–∏–∫ –±–ª–∏–∑–∫–æ –∫ –æ–±—ä–µ–∫—Ç—É (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0.001 –≥—Ä–∞–¥—É—Å–∞)
                            if (distance < 0.001) {
                                var properties = geoObject.properties.getAll();
                                if (properties.name || properties.hint) {
                                    var venueName = properties.name || properties.hint;
                                    fillVenueField(venueName);
                                    showNotification(`–í—ã–±—Ä–∞–Ω–æ –∑–∞–≤–µ–¥–µ–Ω–∏–µ: ${venueName}`);
                                    updateStatus(`–ó–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ: ${venueName}`);
                                    addLog(`–ù–∞–π–¥–µ–Ω–æ –∑–∞–≤–µ–¥–µ–Ω–∏–µ: ${venueName}`, 'success');
                                    
                                    // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–ª–ª—É–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
                                    var balloonInfo = {
                                        name: venueName,
                                        address: properties.address || geoObject.getAddressLine() || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        lat: objCoords[0],
                                        lng: objCoords[1],
                                        type: properties.type || 'venue',
                                        description: properties.description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        phone: properties.phone || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        website: properties.website || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        hours: properties.hours || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        rating: properties.rating || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        reviews_count: properties.reviews_count || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                        full_info: JSON.stringify(properties, null, 2)
                                    };
                                    
                                    addLog(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–≤–µ–¥–µ–Ω–∏–∏: ${venueName}`, 'info');
                                    saveBalloonInfo(balloonInfo);
                                }
                            }
                        }
                    });
                });
            });
        }

        function fillVenueField(venueName) {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è"
            const venueInput = document.getElementById('venue-input');
            if (venueInput) {
                venueInput.value = venueName;
                venueInput.placeholder = '–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è';
            }
        }

        function saveBalloonInfo(balloonInfo) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–ª–ª—É–Ω–∞ –≤ —Ñ–∞–π–ª
            fetch('/api/save-balloon-info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    balloon_info: balloonInfo
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', data.message);
                    showNotification(`‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª: ${data.filename}`);
                    addLog(`‚úÖ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ${data.filename}`, 'success');
                    addLog(`üìÅ –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É: ${data.filepath}`, 'info');
                } else {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', data.error);
                    showNotification(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${data.error}`);
                    addLog(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏');
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ${error.message}`, 'error');
            });
        }

        function showNotification(message) {
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: #4CAF50;
                color: white;
                padding: 15px 25px;
                border-radius: 30px;
                z-index: 1000;
                animation: fadeInOut 3s forwards;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            logContainer.appendChild(logEntry);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
            addLog('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∫–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'info');
        };
    </script>
</body>
</html> 