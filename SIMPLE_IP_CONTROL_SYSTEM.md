# üåê –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ IP-–∞–¥—Ä–µ—Å—É

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç —Å –æ–¥–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ IP –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–Ω–∫–µ—Ç—ã
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É" —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç IP-–∞–¥—Ä–µ—Å
- –ï—Å–ª–∏ —Å —ç—Ç–æ–≥–æ IP —É–∂–µ –µ—Å—Ç—å –∞–Ω–∫–µ—Ç–∞ - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è IP –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∫–µ—Ç—ã IP —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–∑–µ
- IP –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –ø—Ä–æ—Ñ–∏–ª—é

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ IPControl
```sql
CREATE TABLE ip_control (
    id INTEGER PRIMARY KEY,
    ip_address VARCHAR UNIQUE NOT NULL,
    profile_id VARCHAR NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –ú–æ–¥–µ–ª—å IPControl (—Å—Ç—Ä–æ–∫–∏ 185-190)
```python
class IPControl(db.Model):
    """–ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è IP-–∞–¥—Ä–µ—Å–æ–≤"""
    id = db.Column(db.Integer, primary_key=True)
    ip_address = db.Column(db.String, unique=True, nullable=False)
    profile_id = db.Column(db.String, nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
```

### 2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IP (—Å—Ç—Ä–æ–∫–∏ 209-252)
```python
def get_client_ip(request):
    """–ü–æ–ª—É—á–∞–µ—Ç IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–∫—Å–∏"""
    if request.headers.get('X-Forwarded-For'):
        ip = request.headers.get('X-Forwarded-For').split(',')[0].strip()
    elif request.headers.get('X-Real-IP'):
        ip = request.headers.get('X-Real-IP')
    else:
        ip = request.remote_addr
    return ip

def check_ip_restriction(client_ip):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∞–Ω–∫–µ—Ç–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞"""
    ip_record = IPControl.query.filter_by(ip_address=client_ip).first()
    
    if ip_record:
        profile = Profile.query.get(ip_record.profile_id)
        if profile:
            return True, ip_record.profile_id
    
    return False, None

def register_ip(client_ip, profile_id):
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç IP-–∞–¥—Ä–µ—Å –∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ –ø—Ä–æ—Ñ–∏–ª—é"""
    ip_record = IPControl.query.filter_by(ip_address=client_ip).first()
    
    if ip_record:
        ip_record.profile_id = profile_id
    else:
        ip_record = IPControl(ip_address=client_ip, profile_id=profile_id)
        db.session.add(ip_record)
    
    db.session.commit()
    return ip_record
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ create_profile() (—Å—Ç—Ä–æ–∫–∏ 1127-1145)
```python
@app.route('/create', methods=['GET', 'POST'])
def create_profile():
    # –ü–æ–ª—É—á–∞–µ–º IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞
    client_ip = get_client_ip(request)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP-–∞–¥—Ä–µ—Å—É
    has_existing_profile, existing_profile_id = check_ip_restriction(client_ip)
    
    if has_existing_profile:
        if request.method == 'POST':
            return jsonify({
                'success': False,
                'error': f'–° —ç—Ç–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞ ({client_ip}) —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –∞–Ω–∫–µ—Ç–∞. –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–∞ –∞–Ω–∫–µ—Ç–∞.',
                'has_active_profile': True,
                'redirect_url': url_for('view_profile', id=existing_profile_id)
            }), 400
        else:
            return redirect(url_for('view_profile', id=existing_profile_id))
```

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è IP –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (—Å—Ç—Ä–æ–∫–∏ 1253-1254)
```python
# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º IP-–∞–¥—Ä–µ—Å –∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –ø—Ä–æ—Ñ–∏–ª—é
register_ip(client_ip, user_id)
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π JavaScript (—Å—Ç—Ä–æ–∫–∏ 2255-2265)
```javascript
if (data.success === false) {
    console.log('‚ùå –û—à–∏–±–∫–∞:', data.error);
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å redirect_url, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å
    if (data.redirect_url) {
        console.log('üîÑ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å:', data.redirect_url);
        window.location.href = data.redirect_url;
    } else {
        alert(data.error);
    }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ —Å IP:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/create`
   - –°–æ–∑–¥–∞–µ—Ç –∞–Ω–∫–µ—Ç—É —É—Å–ø–µ—à–Ω–æ
   - IP —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–∑–µ

2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ —Å —Ç–æ–≥–æ –∂–µ IP:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/create` —Å–Ω–æ–≤–∞
   - –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–Ω–∫–µ—Ç—É –ø–æ IP
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å

3. **–í—Ö–æ–¥ —Å –¥—Ä—É–≥–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Ç–æ–º –∂–µ IP:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä
   - –ü—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É
   - –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç

4. **–í—Ö–æ–¥ —Å –¥—Ä—É–≥–æ–≥–æ IP:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç —Å –¥—Ä—É–≥–æ–≥–æ IP
   - –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∫–µ—Ç—É

## üéâ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–æ—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥, –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** IP-–∞–¥—Ä–µ—Å —Å–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å
‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚úÖ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:** –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. **–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:** `http://localhost:5000`

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã:**
   ```
   http://localhost:5000/create
   ```

3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∞–Ω–∫–µ—Ç—É —Å–Ω–æ–≤–∞** - —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å

4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –¥—Ä—É–≥–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞** - —Ç–æ–∂–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (IP —Ç–æ—Ç –∂–µ)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `ip_control` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç IP-–∞–¥—Ä–µ—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
  ```sql
  SELECT * FROM ip_control;
  SELECT COUNT(*) FROM ip_control;
  ```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **NAT/–ü—Ä–æ–∫—Å–∏:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ –æ–¥–Ω–∏–º NAT –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –æ–¥–Ω–∏–º IP
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ IP:** –ü—Ä–∏ —Å–º–µ–Ω–µ IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∫–µ—Ç—É
- **VPN/–ü—Ä–æ–∫—Å–∏:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å VPN –±—É–¥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ IP
- **–ú–æ–±–∏–ª—å–Ω—ã–µ —Å–µ—Ç–∏:** –ú–æ–±–∏–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å IP

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

### –û—á–∏—Å—Ç–∫–∞ IP-–∑–∞–ø–∏—Å–µ–π
```python
from app import app, db, IPControl
with app.app_context():
    IPControl.query.delete()
    db.session.commit()
    print('‚úÖ IP-–∑–∞–ø–∏—Å–∏ –æ—á–∏—â–µ–Ω—ã')
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä IP-–∑–∞–ø–∏—Å–µ–π
```python
from app import app, db, IPControl
with app.app_context():
    records = IPControl.query.all()
    for record in records:
        print(f'IP: {record.ip_address} -> Profile: {record.profile_id}')
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å **–æ–¥–∏–Ω IP = –æ–¥–Ω–∞ –∞–Ω–∫–µ—Ç–∞**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–Ω–∫–µ—Ç—ã —Å –æ–¥–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.