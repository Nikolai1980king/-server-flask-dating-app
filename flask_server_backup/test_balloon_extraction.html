<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–æ–≤</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9a3beffb-a8a0-4d55-850f-d258dd28c104&lang=ru_RU" type="text/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        #map {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            box-shadow: 0 4px 16px rgba(76,175,80,0.3);
            transform: translateY(-2px);
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: #333;
        }
        
        .venue-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #333;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–æ–≤</h1>
        
        <div id="map"></div>
        
        <div style="text-align: center; margin: 10px 0;">
            <button type="button" class="btn" onclick="createTestCafes()">üè™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ</button>
            <button type="button" class="btn" onclick="readBalloonInfo()" style="background: linear-gradient(90deg, #2196F3 0%, #64B5F6 100%);">
                üìã –ß–∏—Ç–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–ª—É–Ω–∞
            </button>
        </div>
        
        <label for="venue-input" style="display: block; margin-top: 15px; margin-bottom: 5px;">üìã –ò–∑–≤–ª–µ—á–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
        <input type="text" name="venue" id="venue-input" class="venue-input" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è" readonly>
        
        <div class="info-panel">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "üè™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç—É</li>
                <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Å–∏–Ω—é—é –º–µ—Ç–∫—É - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±–∞–ª—É–Ω —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
                <li>–í –±–∞–ª—É–Ω–µ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"</li>
                <li>–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ß–∏—Ç–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–ª—É–Ω–∞" (–µ—Å–ª–∏ –±–∞–ª—É–Ω –æ—Ç–∫—Ä—ã—Ç)</li>
                <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ –≤—ã—à–µ</li>
            </ol>
        </div>
    </div>

    <script>
        let myMap;
        let selectedVenue = null;
        let testCafes = [];

        function initMap() {
            ymaps.ready(function () {
                myMap = new ymaps.Map('map', {
                    center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞
                    zoom: 12,
                    controls: ['zoomControl', 'fullscreenControl']
                });
                console.log('–ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ñ–µ
        function createTestCafes() {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ñ–µ
            testCafes.forEach(function(cafe) {
                myMap.geoObjects.remove(cafe);
            });
            testCafes = [];

            var center = myMap.getCenter();
            var cafes = [
                {
                    name: '–ö–∞—Ñ–µ "–£—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ"',
                    phone: '+7 (495) 123-45-67',
                    address: '—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 15',
                    lat: center[0] + 0.001,
                    lng: center[1] + 0.001
                },
                {
                    name: '–†–µ—Å—Ç–æ—Ä–∞–Ω "–í–∫—É—Å–Ω–∞—è –µ–¥–∞"',
                    phone: '+7 (495) 234-56-78',
                    address: '—É–ª. –ê—Ä–±–∞—Ç, 25',
                    lat: center[0] - 0.001,
                    lng: center[1] + 0.002
                },
                {
                    name: '–ö–æ—Ñ–µ–π–Ω—è "–ê—Ä–æ–º–∞—Ç"',
                    phone: '+7 (495) 345-67-89',
                    address: '–ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä-—Ç, 10',
                    lat: center[0] + 0.002,
                    lng: center[1] - 0.001
                }
            ];

            cafes.forEach(function(cafe) {
                // –°–æ–∑–¥–∞–µ–º HTML-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –±–∞–ª—É–Ω–∞
                var balloonContent = '<div style="padding: 10px; font-family: Arial, sans-serif;">' +
                    '<h3 style="margin: 0 0 10px 0; color: #333;">' + cafe.name + '</h3>' +
                    '<p style="margin: 5px 0; color: #666;">' +
                    '<strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> <a href="tel:' + cafe.phone + '" style="color: #2196F3;">' + cafe.phone + '</a>' +
                    '</p>' +
                    '<p style="margin: 5px 0; color: #666;">' +
                    '<strong>üìç –ê–¥—Ä–µ—Å:</strong> ' + cafe.address +
                    '</p>' +
                    '<button onclick="extractFromBalloon(\'' + cafe.name.replace(/'/g, '\\\'') + '\', \'' + cafe.phone + '\', \'' + cafe.address.replace(/'/g, '\\\'') + '\')" ' +
                    'style="background: #4CAF50; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-top: 10px;">' +
                    'üìã –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é' +
                    '</button>' +
                    '</div>';

                var cafePlacemark = new ymaps.Placemark([cafe.lat, cafe.lng], {
                    balloonContent: balloonContent
                }, {
                    preset: 'islands#blueDotIcon',
                    iconColor: '#2196F3'
                });

                cafePlacemark.properties.set('name', cafe.name);
                cafePlacemark.properties.set('phone', cafe.phone);
                cafePlacemark.properties.set('address', cafe.address);

                myMap.geoObjects.add(cafePlacemark);
                testCafes.push(cafePlacemark);
            });

            alert('–°–æ–∑–¥–∞–Ω–æ ' + cafes.length + ' —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ñ–µ! –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–∏–Ω–∏–µ –º–µ—Ç–∫–∏.');
            console.log('–°–æ–∑–¥–∞–Ω–æ ' + cafes.length + ' —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ñ–µ');
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–∞
        function extractFromBalloon(name, phone, address) {
            console.log('–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–∞:', name, phone, address);

            var center = myMap.getCenter();
            selectedVenue = {
                name: name,
                phone: phone,
                address: address,
                lat: center[0],
                lng: center[1]
            };

            document.getElementById('venue-input').value = name + ' | ' + phone + ' | ' + address;
            
            if (myMap.balloon) {
                myMap.balloon.close();
            }
            
            alert('üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∞: ' + name);
        }

        // –§—É–Ω–∫—Ü–∏—è —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –ª—é–±–æ–≥–æ –±–∞–ª—É–Ω–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
        function readBalloonInfo() {
            console.log('–ü–æ–ø—ã—Ç–∫–∞ —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞–ª—É–Ω–∞');
            
            if (!myMap.balloon || !myMap.balloon.isOpen()) {
                alert('–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –±–∞–ª—É–Ω–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è!');
                return;
            }

            try {
                var balloonContent = myMap.balloon.getData().content;
                console.log('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–ª—É–Ω–∞:', balloonContent);

                var nameMatch = balloonContent.match(/<h3[^>]*>([^<]+)<\/h3>/);
                var phoneMatch = balloonContent.match(/–¢–µ–ª–µ—Ñ–æ–Ω:<\/strong>\s*<a[^>]*>([^<]+)<\/a>/);
                var addressMatch = balloonContent.match(/–ê–¥—Ä–µ—Å:<\/strong>\s*([^<]+)/);

                var extractedInfo = {
                    name: nameMatch ? nameMatch[1].trim() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                    phone: phoneMatch ? phoneMatch[1].trim() : '–ù–µ —É–∫–∞–∑–∞–Ω',
                    address: addressMatch ? addressMatch[1].trim() : '–ù–µ —É–∫–∞–∑–∞–Ω'
                };

                console.log('–ò–∑–≤–ª–µ—á–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:', extractedInfo);

                var center = myMap.getCenter();
                selectedVenue = {
                    name: extractedInfo.name,
                    phone: extractedInfo.phone,
                    address: extractedInfo.address,
                    lat: center[0],
                    lng: center[1]
                };

                document.getElementById('venue-input').value = extractedInfo.name + ' | ' + extractedInfo.phone + ' | ' + extractedInfo.address;
                
                alert('üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏–∑ –±–∞–ª—É–Ω–∞: ' + extractedInfo.name);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –±–∞–ª—É–Ω–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–ª—É–Ω–∞');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html> 