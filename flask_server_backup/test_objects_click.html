<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç –∫–ª–∏–∫–∞ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º –∫–∞—Ä—Ç—ã</title>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .map-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .map-container {
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        #map {
            width: 100%;
            height: 500px;
            border-radius: 15px;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        .btn:hover {
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }
        .btn-success {
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
        }
        .btn-warning {
            background: linear-gradient(90deg, #ff9800 0%, #ffb74d 100%);
        }
        .btn-danger {
            background: linear-gradient(90deg, #ff6b6b 0%, #ee5a52 100%);
        }
        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .location-info {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .objects-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .object-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }
        .object-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        .object-item.cafe {
            border-left-color: #4CAF50;
        }
        .object-item.shop {
            border-left-color: #FF9800;
        }
        .object-item.bank {
            border-left-color: #2196F3;
        }
        .object-item.pharmacy {
            border-left-color: #9C27B0;
        }
        .status-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-success {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        .status-warning {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }
        .status-error {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        .coordinates-display {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(90deg, #4CAF50 0%, #81c784 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è –¢–µ—Å—Ç –∫–ª–∏–∫–∞ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º –∫–∞—Ä—Ç—ã</h1>
            <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –æ–±—ä–µ–∫—Ç—ã, –∑–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
        </div>

        <div class="map-section">
            <h2>üìç –ö–∞—Ä—Ç–∞</h2>
            <div class="controls">
                <button class="btn btn-success" onclick="getCurrentLocation()">üìç –ú–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                <button class="btn btn-warning" onclick="searchNearbyCafes()">üçΩÔ∏è –ù–∞–π—Ç–∏ –∫–∞—Ñ–µ —Ä—è–¥–æ–º</button>
                <button class="btn btn-danger" onclick="clearMap()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                <button class="btn" onclick="showTestLocations()">üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–æ—á–∫–∏</button>
            </div>
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>

        <div class="map-section">
            <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏</h2>
            <div class="location-info" id="location-info" style="display: none;">
                <strong>–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong><br>
                <span id="location-address">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span><br>
                <small>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="location-coords">-</span></small>
                <div id="location-accuracy"></div>
            </div>
        </div>

        <div class="map-section">
            <h2>üè¢ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã</h2>
            <div class="objects-list" id="objects-list" style="display: none;">
                <div id="objects-content"></div>
            </div>
        </div>

        <div class="map-section">
            <h2>üìù –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</h2>
            <div class="info-panel">
                <div class="coordinates-display" id="coordinates-display" style="display: none;">
                    <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞:</strong><br>
                    <span id="coordinates-text"></span>
                </div>
                <div style="margin-top: 15px;">
                    <label for="venue-input"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è:</strong></label>
                    <input type="text" id="venue-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div>
                        <label for="cafe-lat-input"><strong>–®–∏—Ä–æ—Ç–∞:</strong></label>
                        <input type="number" id="cafe-lat-input" placeholder="–®–∏—Ä–æ—Ç–∞" step="0.000001" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px;">
                    </div>
                    <div>
                        <label for="cafe-lon-input"><strong>–î–æ–ª–≥–æ—Ç–∞:</strong></label>
                        <input type="number" id="cafe-lon-input" placeholder="–î–æ–ª–≥–æ—Ç–∞" step="0.000001" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px;">
                    </div>
                </div>
            </div>
        </div>

        <div class="map-section">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="info-panel">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤:</strong> <span id="total-clicks">0</span>
                    </div>
                    <div>
                        <strong>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤:</strong> <span id="total-objects">0</span>
                    </div>
                    <div>
                        <strong>–ù–∞–π–¥–µ–Ω–æ –∫–∞—Ñ–µ:</strong> <span id="total-cafes">0</span>
                    </div>
                    <div>
                        <strong>–°—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ:</strong> <span id="avg-distance">0</span>–º
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myMap, myPlacemark;
        let currentLocation = null;
        let clickCount = 0;
        let totalObjects = 0;
        let totalCafes = 0;
        let totalDistance = 0;

        function initMap() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ API
            if (typeof ymaps === 'undefined') {
                console.error('‚ùå Yandex Maps API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
                return;
            }
            
            console.log('‚úÖ Yandex Maps API –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É...');
            
            ymaps.ready(function () {
                try {
                    myMap = new ymaps.Map('map', {
                        center: [55.76, 37.64], // –ú–æ—Å–∫–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        zoom: 12,
                        controls: ['zoomControl', 'fullscreenControl', 'geolocationControl']
                    });

                    console.log('‚úÖ –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');

                    myMap.events.add('click', function (e) {
                        var coords = e.get('coords');
                        clickCount++;
                        document.getElementById('total-clicks').textContent = clickCount;
                        console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ:', coords);
                        setLocation(coords[0], coords[1]);
                    });
                    
                    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω');
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç—ã:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç—ã: ' + error.message, 'error');
                }
            });
        }

        function setLocation(lat, lng) {
            currentLocation = {lat: lat, lng: lng};

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–µ—Ç–∫—É
            if (myPlacemark) {
                myMap.geoObjects.remove(myPlacemark);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
            myPlacemark = new ymaps.Placemark([lat, lng], {
                balloonContent: '–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'
            }, {
                preset: 'islands#blueDotIcon'
            });

            myMap.geoObjects.add(myPlacemark);
            myMap.setCenter([lat, lng], 16);

            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            ymaps.geocode([lat, lng]).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                var address = firstGeoObject.getAddressLine();

                document.getElementById('location-address').textContent = address;
                document.getElementById('location-coords').textContent = lat.toFixed(6) + ', ' + lng.toFixed(6);
                document.getElementById('location-info').style.display = 'block';
            });

            // –ò—â–µ–º –æ–±—ä–µ–∫—Ç—ã –≤ —Ç–æ—á–∫–µ –∫–ª–∏–∫–∞
            searchObjectsAtLocation(lat, lng);
        }

        function searchObjectsAtLocation(lat, lng) {
            // –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ —Ä–∞–¥–∏—É—Å–µ 50 –º–µ—Ç—Ä–æ–≤ –æ—Ç —Ç–æ—á–∫–∏ –∫–ª–∏–∫–∞
            ymaps.geocode([lat, lng], {
                results: 15,
                kind: 'biz',
                radius: 50
            }).then(function (res) {
                var objects = [];
                var cafeFound = false;
                
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');
                    var coords = geoObject.geometry.getCoordinates();
                    
                    if (name && name.trim() !== '') {
                        var distance = calculateDistance(lat, lng, coords[0], coords[1]);
                        totalDistance += distance;
                        
                        objects.push({
                            name: name,
                            address: address,
                            coords: coords,
                            type: getObjectType(name),
                            distance: distance
                        });
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ
                        if (!cafeFound && isCafeOrRestaurant(name)) {
                            document.getElementById('venue-input').value = name;
                            document.getElementById('cafe-lat-input').value = coords[0];
                            document.getElementById('cafe-lon-input').value = coords[1];
                            cafeFound = true;
                            totalCafes++;
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                            showCoordinates(name, coords[0], coords[1], distance);
                        }
                    }
                });
                
                totalObjects += objects.length;
                updateStatistics();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É
                objects.forEach(function(obj, index) {
                    var iconColor = getObjectIconColor(obj.type);
                    var objectPlacemark = new ymaps.Placemark(obj.coords, {
                        balloonContent: '<strong>' + obj.name + '</strong><br>' + obj.address + '<br>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(obj.distance) + '–º'
                    }, {
                        preset: 'islands#blueDotIcon',
                        iconColor: iconColor
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                    objectPlacemark.properties.set('type', 'object');
                    objectPlacemark.properties.set('objectName', obj.name);
                    objectPlacemark.properties.set('objectType', obj.type);

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç
                    objectPlacemark.events.add('click', function() {
                        selectObject(obj.name, obj.coords[0], obj.coords[1], obj.distance, obj.type);
                    });

                    myMap.geoObjects.add(objectPlacemark);
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
                showObjectsList(objects, lat, lng);
                
            }).catch(function(error) {
                console.log('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤', 'error');
            });
        }

        function getObjectType(name) {
            var lowerName = name.toLowerCase();
            if (lowerName.includes('–∫–∞—Ñ–µ') || lowerName.includes('–∫–æ—Ñ–µ–π–Ω—è') || 
                lowerName.includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || lowerName.includes('–±–∞—Ä') || 
                lowerName.includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') || lowerName.includes('—Å—Ç–æ–ª–æ–≤–∞—è')) {
                return 'cafe';
            } else if (lowerName.includes('–º–∞–≥–∞–∑–∏–Ω') || lowerName.includes('—Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç') || 
                       lowerName.includes('—Ç–æ—Ä–≥–æ–≤—ã–π') || lowerName.includes('–º–æ–ª–ª')) {
                return 'shop';
            } else if (lowerName.includes('–±–∞–Ω–∫') || lowerName.includes('—Å–±–µ—Ä–±–∞–Ω–∫') || 
                       lowerName.includes('–≤—Ç–±') || lowerName.includes('–∞–ª—å—Ñ–∞')) {
                return 'bank';
            } else if (lowerName.includes('–∞–ø—Ç–µ–∫–∞') || lowerName.includes('—Ñ–∞—Ä–º–∞—Ü–∏—è')) {
                return 'pharmacy';
            } else {
                return 'other';
            }
        }

        function getObjectIconColor(type) {
            switch(type) {
                case 'cafe': return '#4CAF50';
                case 'shop': return '#FF9800';
                case 'bank': return '#2196F3';
                case 'pharmacy': return '#9C27B0';
                default: return '#607D8B';
            }
        }

        function isCafeOrRestaurant(name) {
            var lowerName = name.toLowerCase();
            return lowerName.includes('–∫–∞—Ñ–µ') || 
                   lowerName.includes('—Ä–µ—Å—Ç–æ—Ä–∞–Ω') || 
                   lowerName.includes('–∫–æ—Ñ–µ–π–Ω—è') ||
                   lowerName.includes('–±–∞—Ä') ||
                   lowerName.includes('–ø–∏—Ü—Ü–µ—Ä–∏—è') ||
                   lowerName.includes('—Å—Ç–æ–ª–æ–≤–∞—è') ||
                   lowerName.includes('–±–∏—Å—Ç—Ä–æ') ||
                   lowerName.includes('–ø–∞–±');
        }

        function showObjectsList(objects, lat, lng) {
            var objectsList = document.getElementById('objects-list');
            var objectsContent = document.getElementById('objects-content');
            
            if (objects.length === 0) {
                objectsContent.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">–û–±—ä–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                objectsList.style.display = 'block';
                return;
            }
            
            var html = '<h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (' + objects.length + '):</h3>';
            
            objects.forEach(function(obj, index) {
                var icon = getObjectIcon(obj.type);
                var statusClass = obj.type === 'cafe' ? 'status-success' : 'status-warning';
                
                html += '<div class="object-item ' + obj.type + '" onclick="selectObject(\'' + obj.name.replace(/'/g, "\\'") + '\', ' + obj.coords[0] + ', ' + obj.coords[1] + ', ' + obj.distance + ', \'' + obj.type + '\')">';
                html += icon + ' <strong>' + obj.name + '</strong><br>';
                html += '<small>' + obj.address + '</small><br>';
                html += '<span class="status-indicator ' + statusClass + '">' + Math.round(obj.distance) + '–º</span>';
                html += '</div>';
            });
            
            objectsContent.innerHTML = html;
            objectsList.style.display = 'block';
        }

        function getObjectIcon(type) {
            switch(type) {
                case 'cafe': return 'üçΩÔ∏è';
                case 'shop': return 'üõí';
                case 'bank': return 'üè¶';
                case 'pharmacy': return 'üíä';
                default: return 'üè¢';
            }
        }

        function selectObject(name, lat, lng, distance, type) {
            document.getElementById('venue-input').value = name;
            document.getElementById('cafe-lat-input').value = lat;
            document.getElementById('cafe-lon-input').value = lng;
            
            showCoordinates(name, lat, lng, distance);
            showObjectNotification(name, type, distance);
        }

        function showCoordinates(name, lat, lng, distance) {
            var display = document.getElementById('coordinates-display');
            var text = document.getElementById('coordinates-text');
            
            text.innerHTML = `
                <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> ${name}<br>
                <strong>–®–∏—Ä–æ—Ç–∞:</strong> ${lat.toFixed(6)}<br>
                <strong>–î–æ–ª–≥–æ—Ç–∞:</strong> ${lng.toFixed(6)}<br>
                <strong>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:</strong> ${Math.round(distance)}–º
            `;
            
            display.style.display = 'block';
        }

        function showObjectNotification(name, type, distance) {
            var typeText = '';
            switch(type) {
                case 'cafe': typeText = 'üçΩÔ∏è –ö–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω'; break;
                case 'shop': typeText = 'üõí –ú–∞–≥–∞–∑–∏–Ω'; break;
                case 'bank': typeText = 'üè¶ –ë–∞–Ω–∫'; break;
                case 'pharmacy': typeText = 'üíä –ê–ø—Ç–µ–∫–∞'; break;
                default: typeText = 'üè¢ –û–±—ä–µ–∫—Ç'; break;
            }
            
            showNotification(`${typeText}<br>${name}<br><small>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${Math.round(distance)}–º</small>`, 'success');
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        var accuracy = position.coords.accuracy;
                        
                        setLocation(lat, lng);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ—á–Ω–æ—Å—Ç–∏
                        var accuracyInfo = '';
                        if (accuracy <= 50) {
                            accuracyInfo = '<span class="status-indicator status-success">–û—Ç–ª–∏—á–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (' + accuracy.toFixed(1) + '–º)</span>';
                        } else if (accuracy <= 100) {
                            accuracyInfo = '<span class="status-indicator status-warning">–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å (' + accuracy.toFixed(1) + '–º)</span>';
                        } else {
                            accuracyInfo = '<span class="status-indicator status-error">–ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (' + accuracy.toFixed(1) + '–º)</span>';
                        }
                        
                        document.getElementById('location-accuracy').innerHTML = '<strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> ' + accuracyInfo;
                        
                    },
                    function(error) {
                        showNotification('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: ' + error.message, 'error');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                showNotification('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
            }
        }

        function searchNearbyCafes() {
            if (!currentLocation) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', 'warning');
                return;
            }
            
            // –ü–æ–∏—Å–∫ –∫–∞—Ñ–µ –≤ —Ä–∞–¥–∏—É—Å–µ 500 –º–µ—Ç—Ä–æ–≤
            ymaps.geocode([currentLocation.lat, currentLocation.lng], {
                results: 20,
                kind: 'biz',
                radius: 500
            }).then(function (res) {
                var cafes = [];
                
                res.geoObjects.each(function (geoObject) {
                    var properties = geoObject.properties;
                    var name = properties.get('name');
                    var address = properties.get('description');
                    var coords = geoObject.geometry.getCoordinates();
                    
                    if (name && isCafeOrRestaurant(name)) {
                        var distance = calculateDistance(currentLocation.lat, currentLocation.lng, coords[0], coords[1]);
                        cafes.push({
                            name: name,
                            address: address,
                            coords: coords,
                            distance: distance
                        });
                    }
                });
                
                if (cafes.length > 0) {
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
                    cafes.sort(function(a, b) {
                        return a.distance - b.distance;
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –∫–∞—Ñ–µ –Ω–∞ –∫–∞—Ä—Ç—É
                    cafes.forEach(function(cafe, index) {
                        var cafePlacemark = new ymaps.Placemark(cafe.coords, {
                            balloonContent: '<strong>' + cafe.name + '</strong><br>' + cafe.address + '<br>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ' + Math.round(cafe.distance) + '–º'
                        }, {
                            preset: 'islands#blueDotIcon',
                            iconColor: '#4CAF50'
                        });
                        
                        cafePlacemark.properties.set('type', 'cafe');
                        cafePlacemark.events.add('click', function() {
                            selectObject(cafe.name, cafe.coords[0], cafe.coords[1], cafe.distance, 'cafe');
                        });
                        
                        myMap.geoObjects.add(cafePlacemark);
                    });
                    
                    showNotification('–ù–∞–π–¥–µ–Ω–æ ' + cafes.length + ' –∫–∞—Ñ–µ', 'success');
                } else {
                    showNotification('–ö–∞—Ñ–µ —Ä—è–¥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning');
                }
            });
        }

        function clearMap() {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –º–µ—Ç–∫–∏
            myMap.geoObjects.removeAll();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('venue-input').value = '';
            document.getElementById('cafe-lat-input').value = '';
            document.getElementById('cafe-lon-input').value = '';
            document.getElementById('coordinates-display').style.display = 'none';
            document.getElementById('objects-list').style.display = 'none';
            document.getElementById('location-info').style.display = 'none';
            
            currentLocation = null;
            myPlacemark = null;
            
            showNotification('–ö–∞—Ä—Ç–∞ –æ—á–∏—â–µ–Ω–∞', 'info');
        }

        function showTestLocations() {
            var testLocations = [
                {name: '–¶–µ–Ω—Ç—Ä –ú–æ—Å–∫–≤—ã', lat: 55.7558, lng: 37.6176},
                {name: '–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å', lat: 55.7539, lng: 37.6208},
                {name: '–¢–≤–µ—Ä—Å–∫–∞—è —É–ª–∏—Ü–∞', lat: 55.7600, lng: 37.6100},
                {name: '–ê—Ä–±–∞—Ç', lat: 55.7494, lng: 37.5931}
            ];
            
            testLocations.forEach(function(location, index) {
                setTimeout(function() {
                    var placemark = new ymaps.Placemark([location.lat, location.lng], {
                        balloonContent: '<strong>' + location.name + '</strong><br>–¢–µ—Å—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞'
                    }, {
                        preset: 'islands#yellowDotIcon'
                    });
                    
                    placemark.properties.set('type', 'test');
                    myMap.geoObjects.add(placemark);
                }, index * 500);
            });
            
            showNotification('–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ—á–∫–∏', 'info');
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            var R = 6371000; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateStatistics() {
            document.getElementById('total-objects').textContent = totalObjects;
            document.getElementById('total-cafes').textContent = totalCafes;
            document.getElementById('avg-distance').textContent = totalObjects > 0 ? Math.round(totalDistance / totalObjects) : 0;
        }

        function showNotification(message, type) {
            var notification = document.createElement('div');
            notification.className = 'notification';
            
            var bgColor = '#4CAF50';
            if (type === 'error') bgColor = '#f44336';
            if (type === 'warning') bgColor = '#ff9800';
            if (type === 'info') bgColor = '#2196F3';
            
            notification.style.background = `linear-gradient(90deg, ${bgColor} 0%, ${bgColor}dd 100%)`;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(function() {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html> 